module.exports=[57134,a=>{"use strict";var b=a.i(87924),c=a.i(3130),d=a.i(40695),e=a.i(24017),f=a.i(54161),g=a.i(50944),h=a.i(5050),i=(0,h.createServerReference)("60ffeae0f462715ce4453dfb8488ae43f9be4f0331",h.callServer,void 0,h.findSourceMapURL,"approveRequest"),j=(0,h.createServerReference)("601b8cd2b7c1a147ad8fb3f20e688ae5c73cb54169",h.callServer,void 0,h.findSourceMapURL,"rejectRequest"),k=(0,h.createServerReference)("60e7628212e7a21fde957e4fcd651227af438be834",h.callServer,void 0,h.findSourceMapURL,"requestChanges"),l=a.i(72131),m=a.i(65733),n=a.i(46893);let o=a=>a?new Date(a).toISOString().slice(0,10):"",p=a=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(a);function q({approvals:a}){let h=(0,g.useSearchParams)(),q=(0,g.useRouter)(),r=h.get("id")||"",s=h.get("itemId")||"",t=a.length?a.find(a=>s?[a.itemId,a.requisitionId,a.approvalId,a._id].some(a=>String(a)===String(s)):String(a._id)===String(r))||a[0]:null,[u,v]=(0,l.useState)(null),[w,x]=(0,l.useState)(null),[y,z]=(0,l.useState)(!1),[A,B]=(0,l.useState)(""),[C,D]=(0,l.useState)(!1),[E,F]=(0,l.useState)(""),G=(0,l.useRef)(null),H=async()=>{if(!t?._id)return;x(null),v("approve");let a=await i(String(t._id));(v(null),a?.success)?q.refresh():x(a?.error||"Failed to approve")},I=async()=>{if(!t?._id)return;x(null),v("reject");let a=await j(String(t._id),A);(v(null),a?.success)?(z(!1),q.refresh()):x(a?.error||"Failed to reject")},J=async()=>{if(!t?._id)return;x(null);let a=(G.current?.innerHTML||"").trim();if(!a)return;v("changes");let b=await k(String(t._id),a);(v(null),b?.success)?(D(!1),q.refresh()):x(b?.error||"Failed to request changes")};return(0,b.jsxs)("div",{children:[(0,b.jsx)(c.Card,{className:"mb-6",children:(0,b.jsxs)(c.CardContent,{className:"pt-4 md:pt-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 md:gap-4 mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Queue:"}),(0,b.jsx)(f.Badge,{variant:"secondary",className:"text-xs",children:"My approvals"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Type:"}),(0,b.jsx)(f.Badge,{variant:"secondary",className:"text-xs",children:"Requisitions, POs"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Priority:"}),(0,b.jsx)(f.Badge,{variant:"secondary",className:"text-xs",children:"High-first"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"SLA:"}),(0,b.jsx)(f.Badge,{variant:"secondary",className:"text-xs",children:"Due in 3 days"})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 md:gap-4 text-xs text-muted-foreground",children:[(0,b.jsxs)("span",{children:[a.length," items in your approval queue"]}),(0,b.jsx)("span",{children:"3 items breaching SLA"})]})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 md:gap-6",children:[(0,b.jsxs)(c.Card,{className:"lg:col-span-5",children:[(0,b.jsxs)(c.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(c.CardTitle,{className:"text-base",children:"My approval queue"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Grouped by due date"})]}),(0,b.jsx)(c.CardDescription,{className:"text-xs",children:"Select an item to review and take action."})]}),(0,b.jsxs)(c.CardContent,{children:[(0,b.jsx)("div",{className:"space-y-1",children:0===a.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No approvals pending. Connect to MongoDB to see data."}):a.slice(0,10).map(a=>(0,b.jsxs)("div",{onClick:()=>{var b;let c;return b=String(a._id),c=`/approvals?id=${String(b)}`,void q.replace(c,{scroll:!1})},className:`p-3 rounded-lg cursor-pointer border transition-colors ${String(t?._id)===String(a._id)?"bg-accent/50 border-border":"hover:bg-accent border-transparent hover:border-border"}`,children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"font-medium text-sm mb-1",children:a.itemId}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.type," • ",a.requester]})]}),(0,b.jsx)(e.StatusBadge,{status:a.status})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.StatusBadge,{status:a.priority}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:["Due: ",o(a.dueDate)]})]}),(0,b.jsxs)("span",{className:"font-medium",children:["$",p(a.amount)]})]})]},String(a._id)))}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-4 px-3",children:"Tip: Use Bulk approve above for low-risk, policy-compliant requests."})]})]}),(0,b.jsxs)(c.Card,{className:"lg:col-span-7",children:[(0,b.jsx)(c.CardHeader,{className:"border-b pb-4",children:t?(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3",children:[(0,b.jsxs)(c.CardTitle,{className:"text-sm md:text-base",children:[t.itemId," • ",t.type]}),(0,b.jsx)(e.StatusBadge,{status:t.status})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 md:gap-4 text-xs text-muted-foreground",children:[(0,b.jsxs)("span",{children:["Requester: ",t.requester]}),(0,b.jsxs)("span",{children:["Type: ",t.type]}),(0,b.jsxs)("span",{children:["Due: ",o(t.dueDate)]})]})]}):(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Select an approval from the left"})}),(0,b.jsx)(c.CardContent,{className:"pt-4 md:pt-6",children:(0,b.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Decision context"}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Total amount"}),(0,b.jsxs)("div",{className:"font-medium",children:["$",t?p(t.amount):"-"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Budget impact"}),(0,b.jsx)("div",{className:"font-medium",children:"Remaining after approval: $210,000"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Risk & policy"}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.StatusBadge,{status:t?t.priority:"-"}),(0,b.jsxs)("span",{className:"text-xs",children:["SLA: ",t?o(t.dueDate):"-"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"SLA"}),(0,b.jsxs)("div",{className:"font-medium",children:["Due: ",t?o(t.dueDate):"-"]})]})]})]})]}),(0,b.jsxs)("div",{className:"pt-4 border-t",children:[(0,b.jsx)("h3",{className:"text-sm font-medium mb-3",children:"Summary & items"}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Category"}),(0,b.jsx)("span",{children:"Marketing & events"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Needed by"}),(0,b.jsx)("span",{children:"2025-04-01"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Supplier preference"}),(0,b.jsx)("span",{children:"Existing panel suppliers only"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Approval route"}),(0,b.jsx)("span",{children:"You → Finance → Marketing Director"})]})]})]}),(0,b.jsxs)("div",{className:"pt-4 border-t",children:[(0,b.jsx)("h3",{className:"text-sm font-medium mb-3",children:"Item"}),(0,b.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,b.jsxs)("table",{className:"w-full text-xs",children:[(0,b.jsx)("thead",{className:"bg-muted/50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-left p-2 font-medium",children:"Item"}),(0,b.jsx)("th",{className:"text-right p-2 font-medium",children:"Qty"}),(0,b.jsx)("th",{className:"text-right p-2 font-medium",children:"Unit"}),(0,b.jsx)("th",{className:"text-right p-2 font-medium",children:"Unit cost"}),(0,b.jsx)("th",{className:"text-right p-2 font-medium",children:"Total"})]})}),(0,b.jsxs)("tbody",{children:[(0,b.jsxs)("tr",{className:"border-t",children:[(0,b.jsx)("td",{className:"p-2",children:"Digital ads package (Q2)"}),(0,b.jsx)("td",{className:"text-right p-2",children:"1"}),(0,b.jsx)("td",{className:"text-right p-2",children:"Package"}),(0,b.jsx)("td",{className:"text-right p-2",children:"$32,000"}),(0,b.jsx)("td",{className:"text-right p-2",children:"$32,000"})]}),(0,b.jsxs)("tr",{className:"border-t",children:[(0,b.jsx)("td",{className:"p-2",children:"Event sponsorship - Singapore summit"}),(0,b.jsx)("td",{className:"text-right p-2",children:"1"}),(0,b.jsx)("td",{className:"text-right p-2",children:"Event"}),(0,b.jsx)("td",{className:"text-right p-2",children:"$24,000"}),(0,b.jsx)("td",{className:"text-right p-2",children:"$24,000"})]}),(0,b.jsxs)("tr",{className:"border-t",children:[(0,b.jsx)("td",{className:"p-2",children:"Creative agency support"}),(0,b.jsx)("td",{className:"text-right p-2",children:"40"}),(0,b.jsx)("td",{className:"text-right p-2",children:"Hours"}),(0,b.jsx)("td",{className:"text-right p-2",children:"$170"}),(0,b.jsx)("td",{className:"text-right p-2",children:"$6,800"})]})]})]})})]}),(0,b.jsxs)("div",{className:"pt-4 border-t",children:[(0,b.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Comments & notes"}),(0,b.jsx)("div",{className:"bg-muted/30 p-3 rounded-lg text-xs",children:(0,b.jsx)("p",{className:"italic text-muted-foreground",children:'"Budget aligned with Q2 regional plan. Please confirm final media split before issuing PO." - David Kim, 2025-03-13'})})]}),(0,b.jsxs)("div",{className:"pt-4 border-t",children:[(0,b.jsx)("h3",{className:"text-sm font-medium mb-3",children:"Your decision"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-4",children:"Actions are logged and visible to requester and downstream approvers."}),w&&(0,b.jsx)("div",{className:"text-xs text-destructive",children:w}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,b.jsx)(d.Button,{variant:"outline",size:"sm",className:"flex-1 sm:flex-none",onClick:()=>{F(""),D(!0)},disabled:!t||null!==u,children:"changes"===u?"Processing...":"Request changes"}),(0,b.jsx)(d.Button,{variant:"outline",size:"sm",className:"flex-1 sm:flex-none",onClick:()=>{B(""),z(!0)},disabled:!t||null!==u,children:"reject"===u?"Processing...":"Reject"}),(0,b.jsx)(d.Button,{size:"sm",className:"flex-1",onClick:H,disabled:!t||null!==u,children:"approve"===u?"Processing...":"Approve"})]})]})]})})]}),(0,b.jsx)(m.Dialog,{open:y,onOpenChange:z,children:(0,b.jsxs)(m.DialogContent,{children:[(0,b.jsxs)(m.DialogHeader,{children:[(0,b.jsx)(m.DialogTitle,{children:"Reject approval"}),(0,b.jsx)(m.DialogDescription,{children:"Enter a reason for rejection"})]}),(0,b.jsx)(n.Textarea,{value:A,onChange:a=>B(a.target.value),placeholder:"Reason"}),(0,b.jsxs)(m.DialogFooter,{children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>z(!1),children:"Cancel"}),(0,b.jsx)(d.Button,{onClick:I,disabled:!A||null!==u,children:"reject"===u?"Processing...":"Confirm rejection"})]})]})}),(0,b.jsx)(m.Dialog,{open:C,onOpenChange:D,children:(0,b.jsxs)(m.DialogContent,{children:[(0,b.jsxs)(m.DialogHeader,{children:[(0,b.jsx)(m.DialogTitle,{children:"Request changes"}),(0,b.jsx)(m.DialogDescription,{children:"Describe requested changes"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(d.Button,{variant:"outline",size:"icon-sm",onMouseDown:a=>a.preventDefault(),onClick:()=>document.execCommand("bold"),children:"B"}),(0,b.jsx)(d.Button,{variant:"outline",size:"icon-sm",onMouseDown:a=>a.preventDefault(),onClick:()=>document.execCommand("italic"),children:"I"}),(0,b.jsx)(d.Button,{variant:"outline",size:"icon-sm",onMouseDown:a=>a.preventDefault(),onClick:()=>document.execCommand("underline"),children:"U"}),(0,b.jsx)(d.Button,{variant:"outline",size:"icon-sm",onMouseDown:a=>a.preventDefault(),onClick:()=>document.execCommand("insertUnorderedList"),children:"•"}),(0,b.jsx)(d.Button,{variant:"outline",size:"icon-sm",onMouseDown:a=>a.preventDefault(),onClick:()=>{let a=prompt("Link URL")||"";a&&document.execCommand("createLink",!1,a)},children:"↗"})]}),(0,b.jsx)("div",{ref:G,contentEditable:!0,className:"min-h-[140px] p-3 border rounded-md bg-background text-sm focus:outline-none focus:ring-2 focus:ring-ring",onInput:a=>F(a.target.innerHTML),suppressContentEditableWarning:!0}),(0,b.jsxs)(m.DialogFooter,{children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),(0,b.jsx)(d.Button,{onClick:J,disabled:!E||null!==u,children:"changes"===u?"Processing...":"Submit changes"})]})]})})]})]})}a.s(["default",()=>q],57134)}];

//# sourceMappingURL=components_approvals-client_tsx_e3b474fa._.js.map