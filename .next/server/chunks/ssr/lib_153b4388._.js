module.exports=[22752,24622,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(22017),e=a.i(26046);let f=new e.Schema({poNumber:{type:String,required:!0,unique:!0},supplier:{type:String,required:!0},status:{type:String,enum:["Partially received","Pending receipt","Pending invoice","Closed","Delivered","Shipped","Issued","In transit","Invoiced"],default:"Issued"},delivery:{type:Date},total:{type:Number,required:!0},requester:{type:String},department:{type:String},linkedRequisition:{type:String},currency:{type:String,default:"USD"},purpose:{type:String},paymentTerms:{type:String},keyDates:{issued:Date,requestedDelivery:Date},lineItems:[{line:Number,description:String,ordered:Number,received:Number,remaining:Number,lineTotal:Number}],delivery:{shipTo:String,invoiceTo:String},receiptStatus:{status:String,details:String},invoiceStatus:{status:String,details:String},approvalHistory:[{event:String,date:String,actor:String}],notes:String},{timestamps:!0}),g=e.models.PurchaseOrder||(0,e.model)("PurchaseOrder",f);var h=a.i(13095);async function i(){try{await (0,d.default)();let a=await g.find({}).sort({createdAt:-1}).limit(50).lean();return{success:!0,data:JSON.parse(JSON.stringify(a))}}catch(a){return console.error("[v0] Error fetching purchase orders:",a),{success:!1,error:"Failed to fetch purchase orders"}}}async function j(){try{await (0,d.default)();let a=new Date,b=new Date(a.getFullYear(),a.getMonth(),1),c=new Date(a.getFullYear(),a.getMonth()+1,1),e=await g.aggregate([{$match:{"keyDates.issued":{$gte:b,$lt:c}}},{$group:{_id:null,sum:{$sum:"$total"}}}]),f=e?.[0]?.sum||0;return{success:!0,data:f}}catch(a){return console.error("[v0] Error aggregating MTD spend:",a),{success:!1,error:"Failed to aggregate MTD spend"}}}async function k(a){try{await (0,d.default)();let b=await g.findById(a).lean();if(!b)return{success:!1,error:"Purchase order not found"};return{success:!0,data:JSON.parse(JSON.stringify(b))}}catch(a){return console.error("[v0] Error fetching purchase order:",a),{success:!1,error:"Failed to fetch purchase order"}}}async function l(a,b){try{await (0,d.default)();let e=await g.findByIdAndUpdate(a,{$set:{"receiptStatus.received":b}},{new:!0}).lean();if(!e)return{success:!1,error:"Purchase order not found"};return(0,c.revalidatePath)("/purchase-orders"),{success:!0,data:JSON.parse(JSON.stringify(e))}}catch(a){return console.error("[v0] Error receiving goods:",a),{success:!1,error:"Failed to receive goods"}}}async function m(a){try{await (0,d.default)();let b=await g.findByIdAndUpdate(a,{status:"closed",closedAt:new Date},{new:!0}).lean();if(!b)return{success:!1,error:"Purchase order not found"};return(0,c.revalidatePath)("/purchase-orders"),{success:!0,data:JSON.parse(JSON.stringify(b))}}catch(a){return console.error("[v0] Error closing purchase order:",a),{success:!1,error:"Failed to close purchase order"}}}async function n(a){try{await (0,d.default)();let b=await g.countDocuments(),e=`PO-${(b+1200).toString()}`,f=new Date,h=(a.lineItems||[]).map((a,b)=>{let c=Number(a.qty)||0,d=(Number(a.qty)||0)*(Number(a.unitPrice)||0);return{line:b+1,description:a.description,ordered:c,received:0,remaining:c,lineTotal:d}}),i=h.reduce((a,b)=>a+(Number(b.lineTotal)||0),0),j=await g.create({poNumber:e,supplier:a.supplier,status:"Issued",total:i,requester:a.requester,department:a.department,linkedRequisition:a.linkedRequisition,currency:a.currency||"USD",purpose:a.purpose,paymentTerms:a.paymentTerms,keyDates:{issued:f,requestedDelivery:a.requestedDelivery||void 0},lineItems:h,delivery:{shipTo:"",invoiceTo:""},receiptStatus:{status:"Pending receipt",details:""},invoiceStatus:{status:"Pending invoice",details:""},approvalHistory:[{event:"PO issued",date:f.toISOString(),actor:a.requester||""}],notes:""});return(0,c.revalidatePath)("/purchase-orders"),{success:!0,data:JSON.parse(JSON.stringify(j))}}catch(a){return console.error("[v0] Error creating purchase order:",a),{success:!1,error:"Failed to create purchase order"}}}(0,h.ensureServerEntryExports)([i,j,k,l,m,n]),(0,b.registerServerReference)(i,"00e9a018658eb7e03331b6cc284e99f89a37d0d11b",null),(0,b.registerServerReference)(j,"0097914e959bde3b718ee19b6ac418d208b1a7483c",null),(0,b.registerServerReference)(k,"40a2d59cd688db015a71ddf8c03842d047c3cadfa3",null),(0,b.registerServerReference)(l,"60d03998d407e083e24cd3e626662bd39497acfeb6",null),(0,b.registerServerReference)(m,"40d2ad5d3baa7b392b04fbb82797f2594544e39509",null),(0,b.registerServerReference)(n,"40205469e8fc58204db1420bdbaca451da4e1cae08",null),a.s(["closePurchaseOrder",()=>m,"createPurchaseOrder",()=>n,"getPurchaseOrderById",()=>k,"getPurchaseOrders",()=>i,"getSpendMTD",()=>j,"receiveGoods",()=>l],22752);var o=a.i(5072);let p=new e.Schema({invoiceNumber:{type:String,required:!0,unique:!0},supplier:{type:String,required:!0},poNumber:{type:String},status:{type:String,enum:["Pending approval","Overdue","Pending match","Paid","Closed"],default:"Pending approval"},dueDate:{type:Date},invoiceDate:{type:Date},amount:{type:Number,required:!0},entity:{type:String},currency:{type:String,default:"USD"},matching:{status:String,poMatch:String,grnMatch:String,priceVariance:Number},approvalWorkflow:{owner:String,approvers:[String],sla:Number},coding:{costCenter:String,gl:String,officeSupplies:String,taxCode:String},lineItems:[{description:String,qty:Number,unitPrice:Number,tax:Number,lineTotal:Number}],activity:[{event:String,date:Date,details:String}],notes:String},{timestamps:!0}),q=e.models.Invoice||(0,e.model)("Invoice",p);var r=a.i(74377);async function s(){try{await (0,d.default)();let a=await q.find({}).sort({createdAt:-1}).limit(50).lean();return{success:!0,data:JSON.parse(JSON.stringify(a))}}catch(a){return console.error("[v0] Error fetching invoices:",a),{success:!1,error:"Failed to fetch invoices"}}}async function t(a){try{await (0,d.default)();let b=await q.findById(a).lean();if(!b)return{success:!1,error:"Invoice not found"};return{success:!0,data:JSON.parse(JSON.stringify(b))}}catch(a){return console.error("[v0] Error fetching invoice:",a),{success:!1,error:"Failed to fetch invoice"}}}async function u(a,b){try{let{userId:e}=await (0,o.auth)();if(!e)return{success:!1,error:"Unauthorized"};await (0,d.default)();let f=await q.findByIdAndUpdate(a,{status:"scheduled",scheduledPaymentDate:b,scheduledBy:e},{new:!0}).lean();if(!f)return{success:!1,error:"Invoice not found"};return await (0,r.createNotification)({userId:"FINANCE_USER_ID",type:"invoice_overdue",title:"Payment Scheduled",message:`Invoice ${String(f.invoiceNumber||"")} payment scheduled for ${new Date(b).toLocaleDateString()}`,actionUrl:`/invoices/${String(f._id)}`,priority:"low",metadata:{invoiceNumber:f.invoiceNumber||"",amount:f.amount??0,paymentDate:b}}),(0,c.revalidatePath)("/invoices"),{success:!0,data:JSON.parse(JSON.stringify(f))}}catch(a){return console.error("Error scheduling payment:",a),{success:!1,error:"Failed to schedule payment"}}}async function v(a,b){try{let{userId:e}=await (0,o.auth)();if(!e)return{success:!1,error:"Unauthorized"};await (0,d.default)();let f=await q.findByIdAndUpdate(a,{status:"on_hold",holdReason:b,putOnHoldBy:e},{new:!0}).lean();if(!f)return{success:!1,error:"Invoice not found"};return await (0,r.createNotification)({userId:"PROCUREMENT_USER_ID",type:"invoice_overdue",title:"Invoice Put On Hold",message:`Invoice ${String(f.invoiceNumber||"")} has been put on hold. Reason: ${b}`,actionUrl:`/invoices/${String(f._id)}`,priority:"high",metadata:{invoiceNumber:f.invoiceNumber||"",amount:f.amount??0,holdReason:b}}),(0,c.revalidatePath)("/invoices"),{success:!0,data:JSON.parse(JSON.stringify(f))}}catch(a){return console.error("[v0] Error putting invoice on hold:",a),{success:!1,error:"Failed to put invoice on hold"}}}async function w(){try{let{userId:a}=await (0,o.auth)();if(!a)return{success:!1,error:"Unauthorized"};await (0,d.default)();let b=new Date,c=await q.find({status:{$in:["pending_approval","pending_match"]},dueDate:{$lt:b}}).lean();for(let a of c)await (0,r.createNotification)({userId:"FINANCE_USER_ID",type:"invoice_overdue",title:"Invoice Overdue",message:`Invoice ${a.invoiceNumber} from ${a.supplier} is overdue by ${Math.floor((b.getTime()-new Date(a.dueDate).getTime())/864e5)} days`,actionUrl:`/invoices/${a._id}`,priority:"urgent",metadata:{invoiceNumber:a.invoiceNumber,supplier:a.supplier,amount:a.amount,dueDate:a.dueDate}});return{success:!0,count:c.length}}catch(a){return console.error("[v0] Error checking overdue invoices:",a),{success:!1,error:"Failed to check overdue invoices"}}}(0,h.ensureServerEntryExports)([s,t,u,v,w]),(0,b.registerServerReference)(s,"00edf2497aa68ccbd564b9525e653a469b4a592936",null),(0,b.registerServerReference)(t,"404238581812087ab22264a32595e8cfeaeba81d68",null),(0,b.registerServerReference)(u,"60d217a895644ec69ce9f5c939609a2db9342ccea4",null),(0,b.registerServerReference)(v,"605f1951af970cc85080db6c133d475a3d8fda520d",null),(0,b.registerServerReference)(w,"0071170657dccfb582502bdd6415aa35797f5a27c6",null),a.s(["checkOverdueInvoices",()=>w,"getInvoiceById",()=>t,"getInvoices",()=>s,"putInvoiceOnHold",()=>v,"schedulePayment",()=>u],24622)},43386,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(5072),e=a.i(22017),f=a.i(26046);let g=new f.Schema({requisitionId:{type:String,required:!0,unique:!0},requester:{type:String,required:!0},createdBy:{type:String},branch:{type:String,required:!0},date:{type:Date,required:!0},status:{type:String,enum:["Pending approval","In review","Approved","Rejected"],default:"Pending approval"},amount:{type:Number,required:!0},category:{type:String,required:!0},neededBy:{type:Date},costCenter:{type:String},approvalRoute:{type:String},lineItems:[{description:String,quantity:Number,unit:String,unitCost:Number,total:Number}],comments:[{author:String,text:String,date:Date}],timeline:[{event:String,timestamp:Date,actor:String,details:String}],attachments:[{filename:String,url:String,uploadedAt:{type:Date,default:Date.now}}]},{timestamps:!0}),h=f.models.Requisition||(0,f.model)("Requisition",g);var i=a.i(74377);async function j(){try{let{userId:a}=await (0,d.auth)();if(!a)return{success:!1,error:"Unauthorized"};await (0,e.default)();let b=await h.find({}).sort({createdAt:-1}).limit(50).lean();return{success:!0,data:JSON.parse(JSON.stringify(b))}}catch(a){return console.error("[v0] Error fetching requisitions:",a),{success:!1,error:"Failed to fetch requisitions"}}}async function k(a){try{let{userId:b}=await (0,d.auth)();if(!b)return{success:!1,error:"Unauthorized"};await (0,e.default)();let c=await h.findById(a).lean();if(!c)return{success:!1,error:"Requisition not found"};return{success:!0,data:JSON.parse(JSON.stringify(c))}}catch(a){return console.error("[v0] Error fetching requisition:",a),{success:!1,error:"Failed to fetch requisition"}}}async function l(a){try{let{userId:b}=await (0,d.auth)();if(!b)return{success:!1,error:"Unauthorized"};await (0,e.default)();let f=a.getAll("files");f.length>0&&f[0].size>0&&console.log(`Uploading ${f.length} file(s)...`);let g=a.get("requisitionId");if(!g){let a=await h.countDocuments(),b=new Date().getFullYear();g=`REQ-${b}-${String(a+1).padStart(4,"0")}`}let j=a.get("lineItems"),k=j?JSON.parse(j):[],l=await h.create({requisitionId:g,requester:a.get("requester"),createdBy:b,branch:a.get("branch"),date:a.get("date")?new Date(a.get("date")):new Date,amount:Number(a.get("amount")),category:a.get("category"),neededBy:a.get("neededBy")?new Date(a.get("neededBy")):null,costCenter:a.get("costCenter")||void 0,lineItems:k,timeline:[{event:"Requisition created",timestamp:new Date,actor:b,details:"Requisition submitted for approval"}]});return await (0,i.createNotification)({userId:"admin-user-id-here",type:"requisition_submitted",title:"New Requisition Submitted",message:`${l.requester} submitted ${g} for $${l.amount.toLocaleString()}`,actionUrl:`/requisitions/${l._id}`,priority:"high",metadata:{requisitionId:g,amount:l.amount}}),(0,c.revalidatePath)("/requisitions"),{success:!0,data:JSON.parse(JSON.stringify(l))}}catch(a){return console.error("[createRequisition] Error:",a),{success:!1,error:a.message||"Failed to create requisition"}}}async function m(a,b){try{let{userId:f}=await (0,d.auth)();if(!f)return{success:!1,error:"Unauthorized"};await (0,e.default)();let g=await h.findById(a).lean(),j=await h.findByIdAndUpdate(a,b,{new:!0}).lean();if(!j)return{success:!1,error:"Requisition not found"};return g&&g.status!==j.status&&("approved"===j.status?await (0,i.createNotification)({userId:j.createdBy||"REQUESTER_USER_ID",type:"requisition_approved",title:"Requisition Approved",message:`Your requisition ${j.requisitionId??""} has been approved for $${(j.amount??0).toLocaleString()}`,actionUrl:`/requisitions/${j._id}`,priority:"medium",metadata:{requisitionId:j.requisitionId??"",amount:j.amount??0}}):"rejected"===j.status&&await (0,i.createNotification)({userId:j.createdBy||"REQUESTER_USER_ID",type:"requisition_rejected",title:"Requisition Rejected",message:`Your requisition ${j.requisitionId??""} has been rejected. Please review and resubmit.`,actionUrl:`/requisitions/${j._id}`,priority:"high",metadata:{requisitionId:j.requisitionId??"",amount:j.amount??0}})),(0,c.revalidatePath)("/requisitions"),(0,c.revalidatePath)(`/requisitions/${a}`),{success:!0,data:JSON.parse(JSON.stringify(j))}}catch(a){return console.error("[v0] Error updating requisition:",a),{success:!1,error:"Failed to update requisition"}}}async function n(a){try{let{userId:b}=await (0,d.auth)();if(!b)return{success:!1,error:"Unauthorized"};if(await (0,e.default)(),!await h.findByIdAndDelete(a))return{success:!1,error:"Requisition not found"};return(0,c.revalidatePath)("/requisitions"),{success:!0}}catch(a){return console.error("[v0] Error deleting requisition:",a),{success:!1,error:"Failed to delete requisition"}}}(0,a.i(13095).ensureServerEntryExports)([j,k,l,m,n]),(0,b.registerServerReference)(j,"00f4030896116c02808b53faf984df59a1de335173",null),(0,b.registerServerReference)(k,"40d5ec424d7ddefdbca60c7f34c06bc37e7740486a",null),(0,b.registerServerReference)(l,"404879080b783455bfd8761a09511929474115d36f",null),(0,b.registerServerReference)(m,"60ff2ee15068f4e63a30455fd160fc17df002a8601",null),(0,b.registerServerReference)(n,"401f3217c808aae787169aef11048f8ae55902dbf3",null),a.s(["createRequisition",()=>l,"deleteRequisition",()=>n,"getRequisitionById",()=>k,"getRequisitions",()=>j,"updateRequisition",()=>m],43386)},97011,a=>{"use strict";var b=a.i(26046);let c=new b.Schema({userId:{type:String,required:!0,index:!0},type:{type:String,enum:["requisition_submitted","requisition_approved","requisition_rejected","approval_pending","invoice_overdue","po_issued","tender_response","contract_expiring","budget_threshold","supplier_update"],required:!0},title:{type:String,required:!0},message:{type:String,required:!0},actionUrl:{type:String},priority:{type:String,enum:["low","medium","high","urgent"],default:"medium"},read:{type:Boolean,default:!1},metadata:{type:b.Schema.Types.Mixed},expiresAt:{type:Date}},{timestamps:!0});c.index({userId:1,read:1,createdAt:-1}),c.index({expiresAt:1},{expireAfterSeconds:0});let d=b.models.Notification||(0,b.model)("Notification",c);a.s(["Notification",0,d])},74377,a=>{"use strict";var b=a.i(37936),c=a.i(5072),d=a.i(22017),e=a.i(97011),f=a.i(18558);async function g(a=20){try{let{userId:b}=await (0,c.auth)();if(!b)throw Error("Unauthorized");await (0,d.default)();let f=await e.Notification.find({userId:b}).sort({createdAt:-1}).limit(a).lean();return{success:!0,data:JSON.parse(JSON.stringify(f))}}catch(a){return{success:!1,error:a.message}}}async function h(a=20){try{await (0,d.default)();let b=await e.Notification.find({}).sort({createdAt:-1}).limit(a).lean();return{success:!0,data:JSON.parse(JSON.stringify(b))}}catch(a){return{success:!1,error:"Failed to fetch notifications"}}}async function i(){try{let{userId:a}=await (0,c.auth)();if(!a)throw Error("Unauthorized");await (0,d.default)();let b=await e.Notification.countDocuments({userId:a,read:!1});return{success:!0,count:b}}catch(a){return{success:!1,error:a.message,count:0}}}async function j(a){try{let{userId:b}=await (0,c.auth)();if(!b)throw Error("Unauthorized");return await (0,d.default)(),await e.Notification.findOneAndUpdate({_id:a,userId:b},{read:!0}),(0,f.revalidatePath)("/","layout"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function k(){try{let{userId:a}=await (0,c.auth)();if(!a)throw Error("Unauthorized");return await (0,d.default)(),await e.Notification.updateMany({userId:a,read:!1},{read:!0}),(0,f.revalidatePath)("/","layout"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function l(a){try{let{userId:b}=await (0,c.auth)();if(!b)throw Error("Unauthorized");return await (0,d.default)(),await e.Notification.findOneAndDelete({_id:a,userId:b}),(0,f.revalidatePath)("/","layout"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function m(a){try{await (0,d.default)();let b=await e.Notification.create(a);return{success:!0,data:JSON.parse(JSON.stringify(b))}}catch(a){return{success:!1,error:a.message}}}(0,a.i(13095).ensureServerEntryExports)([g,h,i,j,k,l,m]),(0,b.registerServerReference)(g,"4038dfb1dece52774e405a3da827c0072c4eb6aa73",null),(0,b.registerServerReference)(h,"40d6cf33a11ca521dd13b9c56db2d18fd4ab2493dc",null),(0,b.registerServerReference)(i,"00e7b4a1c132478642418d345503f4c53bdb390c9c",null),(0,b.registerServerReference)(j,"4012a4770a5fca10e2a3ff1d52fc6907455ac5eee8",null),(0,b.registerServerReference)(k,"002a32689d17cb2cb93efe0d9a0dde8c0edec41c9c",null),(0,b.registerServerReference)(l,"4063e6dc301d47e91bde494afbc0d7a04d3079b4db",null),(0,b.registerServerReference)(m,"40a74a8520479e52fb68d37977eafec4c05ca8cf53",null),a.s(["createNotification",()=>m,"deleteNotification",()=>l,"getNotifications",()=>g,"getNotificationsPublic",()=>h,"getUnreadCount",()=>i,"markAllAsRead",()=>k,"markAsRead",()=>j])},41783,a=>{"use strict";var b=a.i(37936),c=a.i(18558),d=a.i(5072),e=a.i(22017),f=a.i(74377),g=a.i(26046);let h=new g.Schema({approvalId:{type:String,required:!0,unique:!0},itemId:{type:String},type:{type:String,enum:["Requisition","Purchase Order"],required:!0},requester:{type:String,required:!0},dueDate:{type:Date},status:{type:String,enum:["Awaiting your approval","Pending review","Parallel approval","SLA breached","approved","rejected","changes_requested"],default:"Awaiting your approval"},priority:{type:String,enum:["High","Medium","Low","Critical"]},amount:{type:Number,required:!0},costCenter:{type:String},branch:{type:String},approvedAt:{type:Date},approvedBy:{type:String},rejectedAt:{type:Date},rejectedBy:{type:String},requestedBy:{type:String},decisionContext:{totalAmount:Number,budgetImpact:Number,riskPolicy:String,sla:String,category:String,neededBy:Date,supplierPreference:String,approvalRoute:String},reason:{type:String},summary:{items:[{description:String,qty:Number,unit:String,unitCost:Number,total:Number}]},timeline:[{event:String,timestamp:Date,actor:String,details:String}],comments:[{author:String,text:String,date:Date}]},{timestamps:!0}),i=g.models.Approval||(0,g.model)("Approval",h);async function j(){try{await (0,e.default)();let a=await i.find({}).sort({createdAt:-1}).limit(50).lean();return{success:!0,data:JSON.parse(JSON.stringify(a))}}catch(a){return console.error("[v0] Error fetching approvals:",a),{success:!1,error:"Failed to fetch approvals"}}}async function k(a){try{await (0,e.default)();let b=await i.findById(a).lean();if(!b)return{success:!1,error:"Approval not found"};return{success:!0,data:JSON.parse(JSON.stringify(b))}}catch(a){return console.error("[v0] Error fetching approval:",a),{success:!1,error:"Failed to fetch approval"}}}async function l(a,b){try{let{userId:g}=await (0,d.auth)();if(!g)return{success:!1,error:"Unauthorized"};await (0,e.default)();let h=await i.findByIdAndUpdate(a,{status:"approved",approvedAt:new Date,approvedBy:g},{new:!0}),j=h?.toObject();if(b&&h&&(j=await i.findByIdAndUpdate(a,{$push:{comments:{author:g,text:b,date:new Date}}},{new:!0}).lean()),!j)return{success:!1,error:"Approval not found"};let k=j,l=k.type?k.type.toLowerCase():"request";return await (0,f.createNotification)({userId:"REQUESTER_USER_ID",type:"approval_pending",title:`${l} Approved`,message:`Your ${l} ${k.itemId??""} for $${(k.amount??0).toLocaleString()} has been approved`,actionUrl:`/${l}s/${k.itemId??""}`,priority:"medium",metadata:{approvalId:k._id,itemId:k.itemId??"",amount:k.amount??0}}),(0,c.revalidatePath)("/approvals"),{success:!0,data:JSON.parse(JSON.stringify(j))}}catch(a){return console.error("[v0] Error approving request:",a),{success:!1,error:"Failed to approve request"}}}async function m(a,b){try{let{userId:g}=await (0,d.auth)();if(!g)return{success:!1,error:"Unauthorized"};await (0,e.default)(),await i.findByIdAndUpdate(a,{status:"rejected",rejectedAt:new Date,rejectedBy:g},{new:!0});let h=await i.findByIdAndUpdate(a,{$push:{comments:{author:g,text:b,date:new Date}}},{new:!0}).lean();if(!h)return{success:!1,error:"Approval not found"};{let a=h.type?h.type.toLowerCase():"request";await (0,f.createNotification)({userId:"REQUESTER_USER_ID",type:"approval_pending",title:`${h.type??"Request"} Rejected`,message:`Your ${a} ${h.itemId??""} has been rejected. ${b}`,actionUrl:`/${a}s/${h.itemId??""}`,priority:"high",metadata:{approvalId:h._id,itemId:h.itemId??"",amount:h.amount??0,rejectionReason:b}})}return(0,c.revalidatePath)("/approvals"),{success:!0,data:JSON.parse(JSON.stringify(h))}}catch(a){return console.error("[v0] Error rejecting request:",a),{success:!1,error:"Failed to reject request"}}}async function n(a,b){try{let{userId:g}=await (0,d.auth)();if(!g)return{success:!1,error:"Unauthorized"};await (0,e.default)(),await i.findByIdAndUpdate(a,{status:"changes_requested",requestedBy:g},{new:!0});let h=await i.findByIdAndUpdate(a,{$push:{comments:{author:g,text:b,date:new Date}}},{new:!0}).lean();if(!h)return{success:!1,error:"Approval not found"};{let a=h.type?h.type.toLowerCase():"request";await (0,f.createNotification)({userId:"REQUESTER_USER_ID",type:"approval_pending",title:"Changes Requested",message:`Changes requested for ${a} ${h.itemId??""}. ${b}`,actionUrl:`/${a}s/${h.itemId??""}`,priority:"medium",metadata:{approvalId:h._id,itemId:h.itemId??"",changeComments:b}})}return(0,c.revalidatePath)("/approvals"),{success:!0,data:JSON.parse(JSON.stringify(h))}}catch(a){return console.error("[v0] Error requesting changes:",a),{success:!1,error:"Failed to request changes"}}}async function o(a,b){try{let{userId:f}=await (0,d.auth)();if(!f)return{success:!1,error:"Unauthorized"};await (0,e.default)();let g=new Date;return await i.updateMany({_id:{$in:a}},{$set:{status:"approved",approvedAt:g,approvedBy:f}}),b&&await i.updateMany({_id:{$in:a}},{$push:{comments:{author:f,text:b,date:g}}}),(0,c.revalidatePath)("/approvals"),{success:!0,count:a.length}}catch(a){return console.error("[v0] Error bulk approving:",a),{success:!1,error:"Failed to bulk approve"}}}(0,a.i(13095).ensureServerEntryExports)([j,k,l,m,n,o]),(0,b.registerServerReference)(j,"00be20e6109a2a8bfeb45dc52d89ce9cb3529fad93",null),(0,b.registerServerReference)(k,"4046faf4469e331a643c411cb99a173fca8249e268",null),(0,b.registerServerReference)(l,"60ffeae0f462715ce4453dfb8488ae43f9be4f0331",null),(0,b.registerServerReference)(m,"601b8cd2b7c1a147ad8fb3f20e688ae5c73cb54169",null),(0,b.registerServerReference)(n,"60e7628212e7a21fde957e4fcd651227af438be834",null),(0,b.registerServerReference)(o,"6086a595719540ed92e78eab72cd0aa2f9091cc22c",null),a.s(["approveRequest",()=>l,"bulkApprove",()=>o,"getApprovalById",()=>k,"getApprovals",()=>j,"rejectRequest",()=>m,"requestChanges",()=>n],41783)}];

//# sourceMappingURL=lib_153b4388._.js.map