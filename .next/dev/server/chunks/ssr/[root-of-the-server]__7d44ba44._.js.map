{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose'\n\nmongoose.set('strictQuery', false)\n\nconst MONGODB_URI = process.env.MONGODB_URI\n\ninterface MongooseCache {\n  conn: typeof mongoose | null\n  promise: Promise<typeof mongoose> | null\n}\n\n// Use global to avoid re-creating connections in Next.js\nlet cached = global.mongoose as MongooseCache\n\nif (!cached) {\n  cached = global.mongoose = { conn: null, promise: null }\n}\n\nexport default async function connectDB() {\n  if (cached.conn) {\n    return cached.conn\n  }\n\n  if (!cached.promise) {\n    if (!MONGODB_URI) {\n      throw new Error('MONGODB_URI is not defined')\n    }\n    cached.promise = mongoose.connect(MONGODB_URI, {\n      bufferCommands: false,\n      serverSelectionTimeoutMS: 5000, \n      socketTimeoutMS: 45000,          \n    })\n  }\n\n  try {\n    cached.conn = await cached.promise\n  } catch (err) {\n    cached.promise = null\n    throw err\n  }\n\n  return cached.conn\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,oHAAQ,CAAC,GAAG,CAAC,eAAe;AAE5B,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAO3C,yDAAyD;AACzD,IAAI,SAAS,yDAAO,QAAQ;AAE5B,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AACzD;AAEe,eAAe;IAC5B,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,IAAI,CAAC,aAAa;YAChB,MAAM,IAAI,MAAM;QAClB;QACA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa;YAC7C,gBAAgB;YAChB,0BAA0B;YAC1B,iBAAiB;QACnB;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,KAAK;QACZ,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB"}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/models/Requisition.ts"],"sourcesContent":["import mongoose, { Schema, model, models } from 'mongoose'\n\nconst RequisitionSchema = new Schema({\n  requisitionId: { type: String, required: true, unique: true },\n  requester: { type: String, required: true },\n  createdBy: { type: String },\n  branch: { type: String, required: true },\n  date: { type: Date, required: true },\n  status: { \n    type: String, \n    enum: ['Pending approval', 'In review', 'Approved', 'Rejected'],\n    default: 'Pending approval'\n  },\n  amount: { type: Number, required: true },\n  category: { type: String, required: true },\n  neededBy: { type: Date },\n  costCenter: { type: String },\n  approvalRoute: { type: String },\n  lineItems: [{\n    description: String,\n    quantity: Number,\n    unit: String,\n    unitCost: Number,\n    total: Number\n  }],\n  comments: [{ \n    author: String,\n    text: String,\n    date: Date\n  }],\n  timeline: [{\n    event: String,\n    timestamp: Date,\n    actor: String,\n    details: String\n  }],\n  attachments: [{\n    filename: String,\n    url: String,\n    uploadedAt: { type: Date, default: Date.now }\n  }],\n}, { timestamps: true })\n\nexport const Requisition = models.Requisition || model('Requisition', RequisitionSchema)\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,oBAAoB,IAAI,mHAAM,CAAC;IACnC,eAAe;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IAC5D,WAAW;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC1C,WAAW;QAAE,MAAM;IAAO;IAC1B,QAAQ;QAAE,MAAM;QAAQ,UAAU;IAAK;IACvC,MAAM;QAAE,MAAM;QAAM,UAAU;IAAK;IACnC,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAoB;YAAa;YAAY;SAAW;QAC/D,SAAS;IACX;IACA,QAAQ;QAAE,MAAM;QAAQ,UAAU;IAAK;IACvC,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,UAAU;QAAE,MAAM;IAAK;IACvB,YAAY;QAAE,MAAM;IAAO;IAC3B,eAAe;QAAE,MAAM;IAAO;IAC9B,WAAW;QAAC;YACV,aAAa;YACb,UAAU;YACV,MAAM;YACN,UAAU;YACV,OAAO;QACT;KAAE;IACF,UAAU;QAAC;YACT,QAAQ;YACR,MAAM;YACN,MAAM;QACR;KAAE;IACF,UAAU;QAAC;YACT,OAAO;YACP,WAAW;YACX,OAAO;YACP,SAAS;QACX;KAAE;IACF,aAAa;QAAC;YACZ,UAAU;YACV,KAAK;YACL,YAAY;gBAAE,MAAM;gBAAM,SAAS,KAAK,GAAG;YAAC;QAC9C;KAAE;AACJ,GAAG;IAAE,YAAY;AAAK;AAEf,MAAM,cAAc,mHAAM,CAAC,WAAW,IAAI,IAAA,kHAAK,EAAC,eAAe"}},
    {"offset": {"line": 148, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/models/Notification.ts"],"sourcesContent":["import mongoose, { Schema, model, models } from 'mongoose'\r\n\r\nconst NotificationSchema = new Schema({\r\n  userId: { type: String, required: true, index: true },\r\n  type: { \r\n    type: String, \r\n    enum: [\r\n      'requisition_submitted',\r\n      'requisition_approved', \r\n      'requisition_rejected',\r\n      'approval_pending',\r\n      'invoice_overdue',\r\n      'po_issued',\r\n      'tender_response',\r\n      'contract_expiring',\r\n      'budget_threshold',\r\n      'supplier_update'\r\n    ],\r\n    required: true \r\n  },\r\n  title: { type: String, required: true },\r\n  message: { type: String, required: true },\r\n  actionUrl: { type: String },\r\n  priority: { \r\n    type: String, \r\n    enum: ['low', 'medium', 'high', 'urgent'],\r\n    default: 'medium'\r\n  },\r\n  read: { type: Boolean, default: false },\r\n  metadata: { type: Schema.Types.Mixed },\r\n  expiresAt: { type: Date }\r\n}, { timestamps: true })\r\n\r\n// Index for efficient queries\r\nNotificationSchema.index({ userId: 1, read: 1, createdAt: -1 })\r\nNotificationSchema.index({ expiresAt: 1 }, { expireAfterSeconds: 0 })\r\n\r\nexport const Notification = models.Notification || model('Notification', NotificationSchema)\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,qBAAqB,IAAI,mHAAM,CAAC;IACpC,QAAQ;QAAE,MAAM;QAAQ,UAAU;QAAM,OAAO;IAAK;IACpD,MAAM;QACJ,MAAM;QACN,MAAM;YACJ;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QACD,UAAU;IACZ;IACA,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,SAAS;QAAE,MAAM;QAAQ,UAAU;IAAK;IACxC,WAAW;QAAE,MAAM;IAAO;IAC1B,UAAU;QACR,MAAM;QACN,MAAM;YAAC;YAAO;YAAU;YAAQ;SAAS;QACzC,SAAS;IACX;IACA,MAAM;QAAE,MAAM;QAAS,SAAS;IAAM;IACtC,UAAU;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,KAAK;IAAC;IACrC,WAAW;QAAE,MAAM;IAAK;AAC1B,GAAG;IAAE,YAAY;AAAK;AAEtB,8BAA8B;AAC9B,mBAAmB,KAAK,CAAC;IAAE,QAAQ;IAAG,MAAM;IAAG,WAAW,CAAC;AAAE;AAC7D,mBAAmB,KAAK,CAAC;IAAE,WAAW;AAAE,GAAG;IAAE,oBAAoB;AAAE;AAE5D,MAAM,eAAe,mHAAM,CAAC,YAAY,IAAI,IAAA,kHAAK,EAAC,gBAAgB"}},
    {"offset": {"line": 226, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/actions/notification-actions.ts"],"sourcesContent":["'use server'\r\n\r\nimport { auth } from '@clerk/nextjs/server'\r\nimport dbConnect from '@/lib/mongodb'\r\nimport { Notification } from '../models/Notification'\r\nimport { revalidatePath } from 'next/cache'\r\n\r\nexport async function getNotifications(limit = 20) {\r\n  try {\r\n    const { userId } = await auth()\r\n    if (!userId) {\r\n      throw new Error('Unauthorized')\r\n    }\r\n\r\n    await dbConnect()\r\n    \r\n    const notifications = await Notification.find({ userId })\r\n      .sort({ createdAt: -1 })\r\n      .limit(limit)\r\n      .lean()\r\n\r\n    return {\r\n      success: true,\r\n      data: JSON.parse(JSON.stringify(notifications))\r\n    }\r\n  } catch (error: any) {\r\n    return {\r\n      success: false,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\nexport async function getNotificationsPublic(limit = 20) {\r\n  try {\r\n    await dbConnect()\r\n    const notifications = await Notification.find({})\r\n      .sort({ createdAt: -1 })\r\n      .limit(limit)\r\n      .lean()\r\n\r\n    return {\r\n      success: true,\r\n      data: JSON.parse(JSON.stringify(notifications))\r\n    }\r\n  } catch (error: any) {\r\n    return {\r\n      success: false,\r\n      error: 'Failed to fetch notifications'\r\n    }\r\n  }\r\n}\r\n\r\nexport async function getUnreadCount() {\r\n  try {\r\n    const { userId } = await auth()\r\n    if (!userId) {\r\n      throw new Error('Unauthorized')\r\n    }\r\n\r\n    await dbConnect()\r\n    \r\n    const count = await Notification.countDocuments({ \r\n      userId, \r\n      read: false \r\n    })\r\n\r\n    return {\r\n      success: true,\r\n      count\r\n    }\r\n  } catch (error: any) {\r\n    return {\r\n      success: false,\r\n      error: error.message,\r\n      count: 0\r\n    }\r\n  }\r\n}\r\n\r\nexport async function markAsRead(notificationId: string) {\r\n  try {\r\n    const { userId } = await auth()\r\n    if (!userId) {\r\n      throw new Error('Unauthorized')\r\n    }\r\n\r\n    await dbConnect()\r\n    \r\n    await Notification.findOneAndUpdate(\r\n      { _id: notificationId, userId },\r\n      { read: true }\r\n    )\r\n\r\n    revalidatePath('/', 'layout')\r\n    \r\n    return { success: true }\r\n  } catch (error: any) {\r\n    return {\r\n      success: false,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\nexport async function markAllAsRead() {\r\n  try {\r\n    const { userId } = await auth()\r\n    if (!userId) {\r\n      throw new Error('Unauthorized')\r\n    }\r\n\r\n    await dbConnect()\r\n    \r\n    await Notification.updateMany(\r\n      { userId, read: false },\r\n      { read: true }\r\n    )\r\n\r\n    revalidatePath('/', 'layout')\r\n    \r\n    return { success: true }\r\n  } catch (error: any) {\r\n    return {\r\n      success: false,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\nexport async function deleteNotification(notificationId: string) {\r\n  try {\r\n    const { userId } = await auth()\r\n    if (!userId) {\r\n      throw new Error('Unauthorized')\r\n    }\r\n\r\n    await dbConnect()\r\n    \r\n    await Notification.findOneAndDelete({ \r\n      _id: notificationId, \r\n      userId \r\n    })\r\n\r\n    revalidatePath('/', 'layout')\r\n    \r\n    return { success: true }\r\n  } catch (error: any) {\r\n    return {\r\n      success: false,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n\r\nexport async function createNotification(data: {\r\n  userId: string\r\n  type: string\r\n  title: string\r\n  message: string\r\n  actionUrl?: string\r\n  priority?: 'low' | 'medium' | 'high' | 'urgent'\r\n  metadata?: any\r\n  expiresAt?: Date\r\n}) {\r\n  try {\r\n    await dbConnect()\r\n    \r\n    const notification = await Notification.create(data)\r\n\r\n    return {\r\n      success: true,\r\n      data: JSON.parse(JSON.stringify(notification))\r\n    }\r\n  } catch (error: any) {\r\n    return {\r\n      success: false,\r\n      error: error.message\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 422, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/actions/requisition-actions.ts"],"sourcesContent":["'use server'\n\nimport { revalidatePath } from 'next/cache'\nimport { auth } from '@clerk/nextjs/server'\nimport dbConnect from '@/lib/mongodb'\nimport { Requisition } from '../models/Requisition'\nimport { createNotification } from '@/lib/actions/notification-actions'\n\nexport async function getRequisitions() {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return { success: false, error: 'Unauthorized' }\n    }\n    \n    await dbConnect()\n    const requisitions = await Requisition.find({})\n      .sort({ createdAt: -1 })\n      .limit(50)\n      .lean()\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(requisitions))\n    }\n  } catch (error) {\n    console.error('[v0] Error fetching requisitions:', error)\n    return { success: false, error: 'Failed to fetch requisitions' }\n  }\n}\n\nexport async function getRequisitionById(id: string) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return { success: false, error: 'Unauthorized' }\n    }\n    \n    await dbConnect()\n    const requisition = await Requisition.findById(id).lean()\n    \n    if (!requisition) {\n      return { success: false, error: 'Requisition not found' }\n    }\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(requisition))\n    }\n  } catch (error) {\n    console.error('[v0] Error fetching requisition:', error)\n    return { success: false, error: 'Failed to fetch requisition' }\n  }\n}\n\nexport async function createRequisition(formData: FormData) {\n  try {\n    const { userId } = await auth()\n    if (!userId) return { success: false, error: 'Unauthorized' }\n\n    await dbConnect()\n\n    // Handle file uploads (optional â€” implement your preferred storage)\n    const files = formData.getAll('files') as File[]\n    const attachmentUrls: string[] = []\n\n    if (files.length > 0 && files[0].size > 0) {\n      // Example: upload to Cloudinary, Supabase, AWS S3, etc.\n      // attachmentUrls = await uploadToCloudinary(files)\n      // For now, just use placeholder or skip\n      console.log(`Uploading ${files.length} file(s)...`)\n    }\n\n    // Auto-generate requisitionId if not provided\n    let requisitionId = formData.get('requisitionId') as string\n    if (!requisitionId) {\n      const count = await Requisition.countDocuments()\n      const year = new Date().getFullYear()\n      requisitionId = `REQ-${year}-${String(count + 1).padStart(4, '0')}`\n    }\n\n    const lineItemsRaw = formData.get('lineItems') as string\n    const lineItems = lineItemsRaw ? JSON.parse(lineItemsRaw) : []\n\n    const requisition = await Requisition.create({\n      requisitionId,\n      requester: formData.get('requester'),\n      createdBy: userId,\n      branch: formData.get('branch'),\n      date: formData.get('date') ? new Date(formData.get('date') as string) : new Date(),\n      amount: Number(formData.get('amount')),\n      category: formData.get('category'),\n      neededBy: formData.get('neededBy') ? new Date(formData.get('neededBy') as string) : null,\n      costCenter: formData.get('costCenter') || undefined,\n      lineItems,\n      // attachments: attachmentUrls, // Add field to schema if needed\n      timeline: [\n        {\n          event: 'Requisition created',\n          timestamp: new Date(),\n          actor: userId,\n          details: 'Requisition submitted for approval'\n        }\n      ]\n    })\n\n    // Create notification\n    await createNotification({\n      userId: 'admin-user-id-here', // Replace with real approver logic\n      type: 'requisition_submitted',\n      title: 'New Requisition Submitted',\n      message: `${requisition.requester} submitted ${requisitionId} for $${requisition.amount.toLocaleString()}`,\n      actionUrl: `/requisitions/${requisition._id}`,\n      priority: 'high',\n      metadata: { requisitionId, amount: requisition.amount }\n    })\n\n    revalidatePath('/requisitions')\n    return { success: true, data: JSON.parse(JSON.stringify(requisition)) }\n  } catch (error: any) {\n    console.error('[createRequisition] Error:', error)\n    return { success: false, error: error.message || 'Failed to create requisition' }\n  }\n}\n\nexport async function updateRequisition(id: string, updates: any) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return { success: false, error: 'Unauthorized' }\n    }\n    \n    await dbConnect()\n    \n    const oldRequisition = await Requisition.findById(id).lean()\n    \n    const requisition = await Requisition.findByIdAndUpdate(\n      id,\n      updates,\n      { new: true }\n    ).lean()\n    \n    if (!requisition) {\n      return { success: false, error: 'Requisition not found' }\n    }\n    \n    const oldReq = oldRequisition as { status?: string } | null\n    const req = requisition as { _id: string; createdBy?: string; requisitionId?: string; amount?: number; status?: string }\n    if (oldReq && oldReq.status !== req.status) {\n      if (req.status === 'approved') {\n        await createNotification({\n          userId: req.createdBy || 'REQUESTER_USER_ID',\n          type: 'requisition_approved',\n          title: 'Requisition Approved',\n          message: `Your requisition ${req.requisitionId ?? ''} has been approved for $${(req.amount ?? 0).toLocaleString()}`,\n          actionUrl: `/requisitions/${req._id}`,\n          priority: 'medium',\n          metadata: {\n            requisitionId: req.requisitionId ?? '',\n            amount: req.amount ?? 0\n          }\n        })\n      } else if (req.status === 'rejected') {\n        await createNotification({\n          userId: req.createdBy || 'REQUESTER_USER_ID',\n          type: 'requisition_rejected',\n          title: 'Requisition Rejected',\n          message: `Your requisition ${req.requisitionId ?? ''} has been rejected. Please review and resubmit.`,\n          actionUrl: `/requisitions/${req._id}`,\n          priority: 'high',\n          metadata: {\n            requisitionId: req.requisitionId ?? '',\n            amount: req.amount ?? 0\n          }\n        })\n      }\n    }\n    \n    revalidatePath('/requisitions')\n    revalidatePath(`/requisitions/${id}`)\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(requisition))\n    }\n  } catch (error) {\n    console.error('[v0] Error updating requisition:', error)\n    return { success: false, error: 'Failed to update requisition' }\n  }\n}\n\nexport async function deleteRequisition(id: string) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return { success: false, error: 'Unauthorized' }\n    }\n    \n    await dbConnect()\n    \n    const requisition = await Requisition.findByIdAndDelete(id)\n    \n    if (!requisition) {\n      return { success: false, error: 'Requisition not found' }\n    }\n    \n    revalidatePath('/requisitions')\n    \n    return { success: true }\n  } catch (error) {\n    console.error('[v0] Error deleting requisition:', error)\n    return { success: false, error: 'Failed to delete requisition' }\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 685, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/models/PurchaseOrder.ts"],"sourcesContent":["import mongoose, { Schema, model, models } from 'mongoose'\n\nconst PurchaseOrderSchema = new Schema({\n  poNumber: { type: String, required: true, unique: true },\n  supplier: { type: String, required: true },\n  status: { \n    type: String, \n    enum: ['Partially received', 'Pending receipt', 'Pending invoice', 'Closed', 'Delivered', 'Shipped', 'Issued', 'In transit', 'Invoiced'],\n    default: 'Issued'\n  },\n  delivery: { type: Date },\n  total: { type: Number, required: true },\n  requester: { type: String },\n  department: { type: String },\n  linkedRequisition: { type: String },\n  currency: { type: String, default: 'USD' },\n  purpose: { type: String },\n  paymentTerms: { type: String },\n  keyDates: {\n    issued: Date,\n    requestedDelivery: Date\n  },\n  lineItems: [{\n    line: Number,\n    description: String,\n    ordered: Number,\n    received: Number,\n    remaining: Number,\n    lineTotal: Number\n  }],\n  delivery: {\n    shipTo: String,\n    invoiceTo: String\n  },\n  receiptStatus: {\n    status: String,\n    details: String\n  },\n  invoiceStatus: {\n    status: String,\n    details: String\n  },\n  approvalHistory: [{\n    event: String,\n    date: String,\n    actor: String\n  }],\n  notes: String\n}, { timestamps: true })\n\nexport const PurchaseOrder = models.PurchaseOrder || model('PurchaseOrder', PurchaseOrderSchema)\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,sBAAsB,IAAI,mHAAM,CAAC;IACrC,UAAU;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACvD,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAsB;YAAmB;YAAmB;YAAU;YAAa;YAAW;YAAU;YAAc;SAAW;QACxI,SAAS;IACX;IACA,UAAU;QAAE,MAAM;IAAK;IACvB,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,WAAW;QAAE,MAAM;IAAO;IAC1B,YAAY;QAAE,MAAM;IAAO;IAC3B,mBAAmB;QAAE,MAAM;IAAO;IAClC,UAAU;QAAE,MAAM;QAAQ,SAAS;IAAM;IACzC,SAAS;QAAE,MAAM;IAAO;IACxB,cAAc;QAAE,MAAM;IAAO;IAC7B,UAAU;QACR,QAAQ;QACR,mBAAmB;IACrB;IACA,WAAW;QAAC;YACV,MAAM;YACN,aAAa;YACb,SAAS;YACT,UAAU;YACV,WAAW;YACX,WAAW;QACb;KAAE;IACF,UAAU;QACR,QAAQ;QACR,WAAW;IACb;IACA,eAAe;QACb,QAAQ;QACR,SAAS;IACX;IACA,eAAe;QACb,QAAQ;QACR,SAAS;IACX;IACA,iBAAiB;QAAC;YAChB,OAAO;YACP,MAAM;YACN,OAAO;QACT;KAAE;IACF,OAAO;AACT,GAAG;IAAE,YAAY;AAAK;AAEf,MAAM,gBAAgB,mHAAM,CAAC,aAAa,IAAI,IAAA,kHAAK,EAAC,iBAAiB"}},
    {"offset": {"line": 784, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/actions/purchase-order-actions.ts"],"sourcesContent":["'use server'\n\nimport { revalidatePath } from 'next/cache'\nimport dbConnect from '@/lib/mongodb'\nimport { PurchaseOrder } from '../models/PurchaseOrder'\n\nexport async function getPurchaseOrders() {\n  try {\n    await dbConnect()\n    const orders = await PurchaseOrder.find({})\n      .sort({ createdAt: -1 })\n      .limit(50)\n      .lean()\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(orders))\n    }\n  } catch (error) {\n    console.error('[v0] Error fetching purchase orders:', error)\n    return { success: false, error: 'Failed to fetch purchase orders' }\n  }\n}\n\nexport async function getSpendMTD() {\n  try {\n    await dbConnect()\n    const now = new Date()\n    const start = new Date(now.getFullYear(), now.getMonth(), 1)\n    const end = new Date(now.getFullYear(), now.getMonth() + 1, 1)\n\n    const result = await PurchaseOrder.aggregate([\n      { $match: { 'keyDates.issued': { $gte: start, $lt: end } } },\n      { $group: { _id: null, sum: { $sum: '$total' } } }\n    ])\n\n    const sum = result?.[0]?.sum || 0\n    return { success: true, data: sum }\n  } catch (error) {\n    console.error('[v0] Error aggregating MTD spend:', error)\n    return { success: false, error: 'Failed to aggregate MTD spend' }\n  }\n}\n\nexport async function getPurchaseOrderById(id: string) {\n  try {\n    await dbConnect()\n    const order = await PurchaseOrder.findById(id).lean()\n    \n    if (!order) {\n      return { success: false, error: 'Purchase order not found' }\n    }\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(order))\n    }\n  } catch (error) {\n    console.error('[v0] Error fetching purchase order:', error)\n    return { success: false, error: 'Failed to fetch purchase order' }\n  }\n}\n\nexport async function receiveGoods(id: string, lineItems: any[]) {\n  try {\n    await dbConnect()\n    \n    const order = await PurchaseOrder.findByIdAndUpdate(\n      id,\n      { \n        $set: { \n          'receiptStatus.received': lineItems \n        }\n      },\n      { new: true }\n    ).lean()\n    \n    if (!order) {\n      return { success: false, error: 'Purchase order not found' }\n    }\n    \n    revalidatePath('/purchase-orders')\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(order))\n    }\n  } catch (error) {\n    console.error('[v0] Error receiving goods:', error)\n    return { success: false, error: 'Failed to receive goods' }\n  }\n}\n\nexport async function closePurchaseOrder(id: string) {\n  try {\n    await dbConnect()\n    \n    const order = await PurchaseOrder.findByIdAndUpdate(\n      id,\n      { \n        status: 'closed',\n        closedAt: new Date()\n      },\n      { new: true }\n    ).lean()\n    \n    if (!order) {\n      return { success: false, error: 'Purchase order not found' }\n    }\n    \n    revalidatePath('/purchase-orders')\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(order))\n    }\n  } catch (error) {\n    console.error('[v0] Error closing purchase order:', error)\n    return { success: false, error: 'Failed to close purchase order' }\n  }\n}\n\nexport async function createPurchaseOrder(data: {\n  supplier: string\n  requester?: string\n  department?: string\n  linkedRequisition?: string\n  currency?: string\n  purpose?: string\n  paymentTerms?: string\n  requestedDelivery?: Date\n  lineItems: Array<{ description: string; qty: number; unitPrice: number }>\n}) {\n  try {\n    await dbConnect()\n\n    const count = await PurchaseOrder.countDocuments()\n    const poNumber = `PO-${(count + 1200).toString()}`\n\n    const now = new Date()\n    const items = (data.lineItems || []).map((li, idx) => {\n      const ordered = Number(li.qty) || 0\n      const received = 0\n      const remaining = ordered\n      const lineTotal = (Number(li.qty) || 0) * (Number(li.unitPrice) || 0)\n      return {\n        line: idx + 1,\n        description: li.description,\n        ordered,\n        received,\n        remaining,\n        lineTotal,\n      }\n    })\n    const total = items.reduce((sum, it) => sum + (Number(it.lineTotal) || 0), 0)\n\n    const po = await PurchaseOrder.create({\n      poNumber,\n      supplier: data.supplier,\n      status: 'Issued',\n      total,\n      requester: data.requester,\n      department: data.department,\n      linkedRequisition: data.linkedRequisition,\n      currency: data.currency || 'USD',\n      purpose: data.purpose,\n      paymentTerms: data.paymentTerms,\n      keyDates: {\n        issued: now,\n        requestedDelivery: data.requestedDelivery || undefined,\n      },\n      lineItems: items,\n      delivery: {\n        shipTo: '',\n        invoiceTo: '',\n      },\n      receiptStatus: {\n        status: 'Pending receipt',\n        details: '',\n      },\n      invoiceStatus: {\n        status: 'Pending invoice',\n        details: '',\n      },\n      approvalHistory: [\n        {\n          event: 'PO issued',\n          date: now.toISOString(),\n          actor: data.requester || '',\n        },\n      ],\n      notes: '',\n    })\n\n    revalidatePath('/purchase-orders')\n\n    return { success: true, data: JSON.parse(JSON.stringify(po)) }\n  } catch (error) {\n    console.error('[v0] Error creating purchase order:', error)\n    return { success: false, error: 'Failed to create purchase order' }\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1031, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/models/Supplier.ts"],"sourcesContent":["import mongoose, { Schema, model, models } from 'mongoose'\n\nconst SupplierSchema = new Schema({\n  supplierId: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  approved: { type: Boolean, default: false },\n  ownerUserId: { type: String, required: true, index: true },\n  segment: { type: String },\n  category: { type: String },\n  region: { type: String },\n  onboarding: {\n    contactPerson: String,\n    phone: String,\n    email: String,\n    goodsType: String,\n    productCategories: [String],\n    supplyAreas: [String],\n    deliveryTimeline: String,\n    priceListUploads: [{ name: String, size: Number, type: String }],\n    registrationCertificateUploads: [{ name: String, size: Number, type: String }],\n    businessRegistrationCertificateUploads: [{ name: String, size: Number, type: String }],\n    taxClearanceCertificateUploads: [{ name: String, size: Number, type: String }],\n    gstVatRegistrationCertificateUploads: [{ name: String, size: Number, type: String }],\n    businessLicenseUploads: [{ name: String, size: Number, type: String }],\n    nassitCertificateUploads: [{ name: String, size: Number, type: String }],\n    sectorSpecificCertificateUploads: [{ name: String, size: Number, type: String }],\n    paymentMethods: [String],\n    bankDetails: {\n      bankName: String,\n      accountName: String,\n      accountNumber: String,\n      prefersCash: Boolean,\n    },\n    declarations: {\n      infoAccurate: Boolean,\n      agreeRules: Boolean,\n    },\n  },\n  risk: { \n    type: String, \n    enum: ['Low', 'Medium', 'High', 'Under review']\n  },\n  onTimePerformance: { type: Number },\n  fy24Spend: { type: Number },\n  performanceScore: { type: Number },\n  riskStatus: { type: String },\n  primaryCategory: { type: String },\n  commercialTerms: {\n    paymentTerms: String,\n    diversityStatus: String\n  },\n  performanceMetrics: {\n    deliveryPerformance: {\n      onTime: Number,\n      avgLeadTime: Number,\n      lateDeliveries: Number\n    },\n    qualityMetrics: {\n      returnRate: Number,\n      qualityIncidents: Number,\n      criticalEvents: Number\n    },\n    financialMetrics: {\n      externalRating: String,\n      creditLimit: Number,\n      overdueInvoices: Boolean,\n      paymentAge: Number\n    },\n    complianceStatus: {\n      kyc: String,\n      aml: String,\n      insuranceCerts: Boolean,\n      sanctions: String\n    }\n  },\n  contacts: [{\n    role: String,\n    name: String,\n    email: String,\n    phone: String\n  }],\n  documents: [{\n    name: String,\n    type: String,\n    size: String,\n    signedDate: String,\n    expiresDate: String,\n    owner: String\n  }],\n  recentActivity: [{\n    event: String,\n    date: String,\n    owner: String\n  }]\n}, { timestamps: true })\n\nexport const Supplier = models.Supplier || model('Supplier', SupplierSchema)\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,iBAAiB,IAAI,mHAAM,CAAC;IAChC,YAAY;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACzD,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,UAAU;QAAE,MAAM;QAAS,SAAS;IAAM;IAC1C,aAAa;QAAE,MAAM;QAAQ,UAAU;QAAM,OAAO;IAAK;IACzD,SAAS;QAAE,MAAM;IAAO;IACxB,UAAU;QAAE,MAAM;IAAO;IACzB,QAAQ;QAAE,MAAM;IAAO;IACvB,YAAY;QACV,eAAe;QACf,OAAO;QACP,OAAO;QACP,WAAW;QACX,mBAAmB;YAAC;SAAO;QAC3B,aAAa;YAAC;SAAO;QACrB,kBAAkB;QAClB,kBAAkB;YAAC;gBAAE,MAAM;gBAAQ,MAAM;gBAAQ,MAAM;YAAO;SAAE;QAChE,gCAAgC;YAAC;gBAAE,MAAM;gBAAQ,MAAM;gBAAQ,MAAM;YAAO;SAAE;QAC9E,wCAAwC;YAAC;gBAAE,MAAM;gBAAQ,MAAM;gBAAQ,MAAM;YAAO;SAAE;QACtF,gCAAgC;YAAC;gBAAE,MAAM;gBAAQ,MAAM;gBAAQ,MAAM;YAAO;SAAE;QAC9E,sCAAsC;YAAC;gBAAE,MAAM;gBAAQ,MAAM;gBAAQ,MAAM;YAAO;SAAE;QACpF,wBAAwB;YAAC;gBAAE,MAAM;gBAAQ,MAAM;gBAAQ,MAAM;YAAO;SAAE;QACtE,0BAA0B;YAAC;gBAAE,MAAM;gBAAQ,MAAM;gBAAQ,MAAM;YAAO;SAAE;QACxE,kCAAkC;YAAC;gBAAE,MAAM;gBAAQ,MAAM;gBAAQ,MAAM;YAAO;SAAE;QAChF,gBAAgB;YAAC;SAAO;QACxB,aAAa;YACX,UAAU;YACV,aAAa;YACb,eAAe;YACf,aAAa;QACf;QACA,cAAc;YACZ,cAAc;YACd,YAAY;QACd;IACF;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAO;YAAU;YAAQ;SAAe;IACjD;IACA,mBAAmB;QAAE,MAAM;IAAO;IAClC,WAAW;QAAE,MAAM;IAAO;IAC1B,kBAAkB;QAAE,MAAM;IAAO;IACjC,YAAY;QAAE,MAAM;IAAO;IAC3B,iBAAiB;QAAE,MAAM;IAAO;IAChC,iBAAiB;QACf,cAAc;QACd,iBAAiB;IACnB;IACA,oBAAoB;QAClB,qBAAqB;YACnB,QAAQ;YACR,aAAa;YACb,gBAAgB;QAClB;QACA,gBAAgB;YACd,YAAY;YACZ,kBAAkB;YAClB,gBAAgB;QAClB;QACA,kBAAkB;YAChB,gBAAgB;YAChB,aAAa;YACb,iBAAiB;YACjB,YAAY;QACd;QACA,kBAAkB;YAChB,KAAK;YACL,KAAK;YACL,gBAAgB;YAChB,WAAW;QACb;IACF;IACA,UAAU;QAAC;YACT,MAAM;YACN,MAAM;YACN,OAAO;YACP,OAAO;QACT;KAAE;IACF,WAAW;QAAC;YACV,MAAM;YACN,MAAM;YACN,MAAM;YACN,YAAY;YACZ,aAAa;YACb,OAAO;QACT;KAAE;IACF,gBAAgB;QAAC;YACf,OAAO;YACP,MAAM;YACN,OAAO;QACT;KAAE;AACJ,GAAG;IAAE,YAAY;AAAK;AAEf,MAAM,WAAW,mHAAM,CAAC,QAAQ,IAAI,IAAA,kHAAK,EAAC,YAAY"}},
    {"offset": {"line": 1232, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/actions/supplier-actions.ts"],"sourcesContent":["'use server'\n\nimport { revalidatePath } from 'next/cache'\nimport dbConnect from '@/lib/mongodb'\nimport { Supplier } from '../models/Supplier'\n\nexport async function getSuppliers() {\n  try {\n    await dbConnect()\n    const suppliers = await Supplier.find({ approved: true })\n      .sort({ performanceScore: -1 })\n      .limit(50)\n      .lean()\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(suppliers))\n    }\n  } catch (error) {\n    console.error('[v0] Error fetching suppliers:', error)\n    return { success: false, error: 'Failed to fetch suppliers' }\n  }\n}\n\nexport async function getSupplierById(id: string) {\n  try {\n    await dbConnect()\n    const supplier = await Supplier.findById(id).lean()\n    \n    if (!supplier) {\n      return { success: false, error: 'Supplier not found' }\n    }\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(supplier))\n    }\n  } catch (error) {\n    console.error('[v0] Error fetching supplier:', error)\n    return { success: false, error: 'Failed to fetch supplier' }\n  }\n}\n\nexport async function createSupplier(data: any) {\n  try {\n    await dbConnect()\n    \n    const supplier = await Supplier.create(data)\n    revalidatePath('/suppliers')\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(supplier))\n    }\n  } catch (error) {\n    console.error('[v0] Error creating supplier:', error)\n    return { success: false, error: 'Failed to create supplier' }\n  }\n}\n\nexport async function updateSupplier(id: string, updates: any) {\n  try {\n    await dbConnect()\n    \n    const supplier = await Supplier.findByIdAndUpdate(\n      id,\n      updates,\n      { new: true }\n    ).lean()\n    \n    if (!supplier) {\n      return { success: false, error: 'Supplier not found' }\n    }\n    \n    revalidatePath('/suppliers')\n    revalidatePath(`/suppliers/${id}`)\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(supplier))\n    }\n  } catch (error) {\n    console.error('[v0] Error updating supplier:', error)\n    return { success: false, error: 'Failed to update supplier' }\n  }\n}\n\nexport async function deleteSupplier(id: string) {\n  try {\n    await dbConnect()\n    \n    const supplier = await Supplier.findByIdAndDelete(id)\n    \n    if (!supplier) {\n      return { success: false, error: 'Supplier not found' }\n    }\n    \n    revalidatePath('/suppliers')\n    \n    return { success: true }\n  } catch (error) {\n    console.error('[v0] Error deleting supplier:', error)\n    return { success: false, error: 'Failed to delete supplier' }\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;AAEA;AACA;AACA;;;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,IAAA,yHAAS;QACf,MAAM,YAAY,MAAM,qIAAQ,CAAC,IAAI,CAAC;YAAE,UAAU;QAAK,GACpD,IAAI,CAAC;YAAE,kBAAkB,CAAC;QAAE,GAC5B,KAAK,CAAC,IACN,IAAI;QAEP,OAAO;YACL,SAAS;YACT,MAAM,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;QAClC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO;YAAE,SAAS;YAAO,OAAO;QAA4B;IAC9D;AACF;AAEO,eAAe,gBAAgB,EAAU;IAC9C,IAAI;QACF,MAAM,IAAA,yHAAS;QACf,MAAM,WAAW,MAAM,qIAAQ,CAAC,QAAQ,CAAC,IAAI,IAAI;QAEjD,IAAI,CAAC,UAAU;YACb,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAqB;QACvD;QAEA,OAAO;YACL,SAAS;YACT,MAAM,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;QAClC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO;YAAE,SAAS;YAAO,OAAO;QAA2B;IAC7D;AACF;AAEO,eAAe,eAAe,IAAS;IAC5C,IAAI;QACF,MAAM,IAAA,yHAAS;QAEf,MAAM,WAAW,MAAM,qIAAQ,CAAC,MAAM,CAAC;QACvC,IAAA,+IAAc,EAAC;QAEf,OAAO;YACL,SAAS;YACT,MAAM,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;QAClC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO;YAAE,SAAS;YAAO,OAAO;QAA4B;IAC9D;AACF;AAEO,eAAe,eAAe,EAAU,EAAE,OAAY;IAC3D,IAAI;QACF,MAAM,IAAA,yHAAS;QAEf,MAAM,WAAW,MAAM,qIAAQ,CAAC,iBAAiB,CAC/C,IACA,SACA;YAAE,KAAK;QAAK,GACZ,IAAI;QAEN,IAAI,CAAC,UAAU;YACb,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAqB;QACvD;QAEA,IAAA,+IAAc,EAAC;QACf,IAAA,+IAAc,EAAC,CAAC,WAAW,EAAE,IAAI;QAEjC,OAAO;YACL,SAAS;YACT,MAAM,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;QAClC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO;YAAE,SAAS;YAAO,OAAO;QAA4B;IAC9D;AACF;AAEO,eAAe,eAAe,EAAU;IAC7C,IAAI;QACF,MAAM,IAAA,yHAAS;QAEf,MAAM,WAAW,MAAM,qIAAQ,CAAC,iBAAiB,CAAC;QAElD,IAAI,CAAC,UAAU;YACb,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAqB;QACvD;QAEA,IAAA,+IAAc,EAAC;QAEf,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO;YAAE,SAAS;YAAO,OAAO;QAA4B;IAC9D;AACF;;;IAlGsB;IAkBA;IAmBA;IAiBA;IA2BA;;AAjFA,+OAAA;AAkBA,+OAAA;AAmBA,+OAAA;AAiBA,+OAAA;AA2BA,+OAAA"}},
    {"offset": {"line": 1377, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/models/Invoice.ts"],"sourcesContent":["import mongoose, { Schema, model, models } from 'mongoose'\n\nconst InvoiceSchema = new Schema({\n  invoiceNumber: { type: String, required: true, unique: true },\n  supplier: { type: String, required: true },\n  poNumber: { type: String },\n  status: { \n    type: String, \n    enum: ['Pending approval', 'Overdue', 'Pending match', 'Paid', 'Closed'],\n    default: 'Pending approval'\n  },\n  dueDate: { type: Date },\n  invoiceDate: { type: Date },\n  amount: { type: Number, required: true },\n  entity: { type: String },\n  currency: { type: String, default: 'USD' },\n  matching: {\n    status: String,\n    poMatch: String,\n    grnMatch: String,\n    priceVariance: Number\n  },\n  approvalWorkflow: {\n    owner: String,\n    approvers: [String],\n    sla: Number\n  },\n  coding: {\n    costCenter: String,\n    gl: String,\n    officeSupplies: String,\n    taxCode: String\n  },\n  lineItems: [{\n    description: String,\n    qty: Number,\n    unitPrice: Number,\n    tax: Number,\n    lineTotal: Number\n  }],\n  activity: [{\n    event: String,\n    date: Date,\n    details: String\n  }],\n  notes: String\n}, { timestamps: true })\n\nexport const Invoice = models.Invoice || model('Invoice', InvoiceSchema)\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,gBAAgB,IAAI,mHAAM,CAAC;IAC/B,eAAe;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IAC5D,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,UAAU;QAAE,MAAM;IAAO;IACzB,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAoB;YAAW;YAAiB;YAAQ;SAAS;QACxE,SAAS;IACX;IACA,SAAS;QAAE,MAAM;IAAK;IACtB,aAAa;QAAE,MAAM;IAAK;IAC1B,QAAQ;QAAE,MAAM;QAAQ,UAAU;IAAK;IACvC,QAAQ;QAAE,MAAM;IAAO;IACvB,UAAU;QAAE,MAAM;QAAQ,SAAS;IAAM;IACzC,UAAU;QACR,QAAQ;QACR,SAAS;QACT,UAAU;QACV,eAAe;IACjB;IACA,kBAAkB;QAChB,OAAO;QACP,WAAW;YAAC;SAAO;QACnB,KAAK;IACP;IACA,QAAQ;QACN,YAAY;QACZ,IAAI;QACJ,gBAAgB;QAChB,SAAS;IACX;IACA,WAAW;QAAC;YACV,aAAa;YACb,KAAK;YACL,WAAW;YACX,KAAK;YACL,WAAW;QACb;KAAE;IACF,UAAU;QAAC;YACT,OAAO;YACP,MAAM;YACN,SAAS;QACX;KAAE;IACF,OAAO;AACT,GAAG;IAAE,YAAY;AAAK;AAEf,MAAM,UAAU,mHAAM,CAAC,OAAO,IAAI,IAAA,kHAAK,EAAC,WAAW"}},
    {"offset": {"line": 1468, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/actions/invoice-actions.ts"],"sourcesContent":["\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport { auth } from \"@clerk/nextjs/server\";\nimport dbConnect from \"@/lib/mongodb\";\nimport { Invoice } from \"../models/Invoice\";\nimport { createNotification } from \"./notification-actions\";\n\nexport async function getInvoices() {\n  try {\n    await dbConnect();\n    const invoices = await Invoice.find({})\n      .sort({ createdAt: -1 })\n      .limit(50)\n      .lean();\n\n    return {\n      success: true,\n      data: JSON.parse(JSON.stringify(invoices)),\n    };\n  } catch (error) {\n    console.error(\"[v0] Error fetching invoices:\", error);\n    return { success: false, error: \"Failed to fetch invoices\" };\n  }\n}\n\nexport async function getInvoiceById(id: string) {\n  try {\n    await dbConnect();\n    const invoice = await Invoice.findById(id).lean();\n\n    if (!invoice) {\n      return { success: false, error: \"Invoice not found\" };\n    }\n\n    return {\n      success: true,\n      data: JSON.parse(JSON.stringify(invoice)),\n    };\n  } catch (error) {\n    console.error(\"[v0] Error fetching invoice:\", error);\n    return { success: false, error: \"Failed to fetch invoice\" };\n  }\n}\n\nexport async function createInvoice(payload: {\n  invoiceNumber: string;\n  supplier: string;\n  amount: number;\n  poNumber?: string;\n  dueDate?: Date;\n  invoiceDate?: Date;\n  entity?: string;\n  currency?: string;\n  lineItems?: Array<{\n    description: string;\n    qty: number;\n    unitPrice: number;\n    tax?: number;\n    lineTotal?: number;\n  }>;\n  notes?: string;\n}) {\n  try {\n    await dbConnect();\n    const doc = await Invoice.create({\n      invoiceNumber: payload.invoiceNumber,\n      supplier: payload.supplier,\n      amount: payload.amount,\n      poNumber: payload.poNumber,\n      dueDate: payload.dueDate,\n      invoiceDate: payload.invoiceDate || new Date(),\n      entity: payload.entity,\n      currency: payload.currency || \"USD\",\n      status: \"Pending approval\",\n      lineItems: payload.lineItems || [],\n      notes: payload.notes || \"\",\n    });\n\n    revalidatePath(\"/invoices\");\n\n    return { success: true, data: JSON.parse(JSON.stringify(doc)) };\n  } catch (error) {\n    console.error(\"[v0] Error creating invoice:\", error);\n    return { success: false, error: \"Failed to create invoice\" };\n  }\n}\n\nexport async function approveInvoice(id: string) {\n  try {\n    const { userId } = await auth();\n    if (!userId) {\n      return { success: false, error: \"Unauthorized\" };\n    }\n\n    await dbConnect();\n\n    const invoice = await Invoice.findByIdAndUpdate(\n      id,\n      { status: \"approved_for_payment\" },\n      { new: true }\n    ).lean();\n\n    if (!invoice) {\n      return { success: false, error: \"Invoice not found\" };\n    }\n\n    await createNotification({\n      userId: \"FINANCE_USER_ID\",\n      type: \"invoice_update\",\n      title: \"Invoice Approved for Payment\",\n      message: `Invoice ${String(\n        (invoice as any).invoiceNumber || \"\"\n      )} approved for payment`,\n      actionUrl: `/invoices/${String((invoice as any)._id)}`,\n      priority: \"medium\",\n      metadata: {\n        invoiceNumber: (invoice as any).invoiceNumber || \"\",\n        supplier: (invoice as any).supplier || \"\",\n        amount: (invoice as any).amount ?? 0,\n      },\n    });\n\n    revalidatePath(\"/invoices\");\n\n    return { success: true, data: JSON.parse(JSON.stringify(invoice)) };\n  } catch (error) {\n    console.error(\"[v0] Error approving invoice:\", error);\n    return { success: false, error: \"Failed to approve invoice\" };\n  }\n}\n\nexport async function schedulePayment(id: string, paymentDate: Date) {\n  try {\n    const { userId } = await auth();\n    if (!userId) {\n      return { success: false, error: \"Unauthorized\" };\n    }\n\n    await dbConnect();\n\n    const invoice = await Invoice.findByIdAndUpdate(\n      id,\n      {\n        status: \"scheduled\",\n        scheduledPaymentDate: paymentDate,\n        scheduledBy: userId,\n      },\n      { new: true }\n    ).lean();\n\n    if (!invoice) {\n      return { success: false, error: \"Invoice not found\" };\n    }\n\n    const inv = invoice as {\n      _id: string;\n      invoiceNumber?: string;\n      amount?: number;\n    };\n    await createNotification({\n      userId: \"FINANCE_USER_ID\",\n      type: \"invoice_overdue\",\n      title: \"Payment Scheduled\",\n      message: `Invoice ${String(\n        inv.invoiceNumber || \"\"\n      )} payment scheduled for ${new Date(paymentDate).toLocaleDateString()}`,\n      actionUrl: `/invoices/${String(inv._id)}`,\n      priority: \"low\",\n      metadata: {\n        invoiceNumber: inv.invoiceNumber || \"\",\n        amount: inv.amount ?? 0,\n        paymentDate: paymentDate,\n      },\n    });\n\n    revalidatePath(\"/invoices\");\n\n    return {\n      success: true,\n      data: JSON.parse(JSON.stringify(invoice)),\n    };\n  } catch (error) {\n    console.error(\"Error scheduling payment:\", error);\n    return { success: false, error: \"Failed to schedule payment\" };\n  }\n}\n\nexport async function putInvoiceOnHold(id: string, reason: string) {\n  try {\n    const { userId } = await auth();\n    if (!userId) {\n      return { success: false, error: \"Unauthorized\" };\n    }\n\n    await dbConnect();\n\n    const invoice = await Invoice.findByIdAndUpdate(\n      id,\n      {\n        status: \"on_hold\",\n        holdReason: reason,\n        putOnHoldBy: userId,\n      },\n      { new: true }\n    ).lean();\n\n    if (!invoice) {\n      return { success: false, error: \"Invoice not found\" };\n    }\n\n    const inv2 = invoice as {\n      _id: string;\n      invoiceNumber?: string;\n      amount?: number;\n    };\n    await createNotification({\n      userId: \"PROCUREMENT_USER_ID\", // In production, get procurement manager ID\n      type: \"invoice_overdue\",\n      title: \"Invoice Put On Hold\",\n      message: `Invoice ${String(\n        inv2.invoiceNumber || \"\"\n      )} has been put on hold. Reason: ${reason}`,\n      actionUrl: `/invoices/${String(inv2._id)}`,\n      priority: \"high\",\n      metadata: {\n        invoiceNumber: inv2.invoiceNumber || \"\",\n        amount: inv2.amount ?? 0,\n        holdReason: reason,\n      },\n    });\n\n    revalidatePath(\"/invoices\");\n\n    return {\n      success: true,\n      data: JSON.parse(JSON.stringify(invoice)),\n    };\n  } catch (error) {\n    console.error(\"[v0] Error putting invoice on hold:\", error);\n    return { success: false, error: \"Failed to put invoice on hold\" };\n  }\n}\n\nexport async function checkOverdueInvoices() {\n  try {\n    const { userId } = await auth();\n    if (!userId) {\n      return { success: false, error: \"Unauthorized\" };\n    }\n\n    await dbConnect();\n\n    const today = new Date();\n    const overdueInvoices = await Invoice.find({\n      status: { $in: [\"pending_approval\", \"pending_match\"] },\n      dueDate: { $lt: today },\n    }).lean();\n\n    for (const invoice of overdueInvoices) {\n      await createNotification({\n        userId: \"FINANCE_USER_ID\",\n        type: \"invoice_overdue\",\n        title: \"Invoice Overdue\",\n        message: `Invoice ${invoice.invoiceNumber} from ${\n          invoice.supplier\n        } is overdue by ${Math.floor(\n          (today.getTime() - new Date(invoice.dueDate).getTime()) /\n            (1000 * 60 * 60 * 24)\n        )} days`,\n        actionUrl: `/invoices/${invoice._id}`,\n        priority: \"urgent\",\n        metadata: {\n          invoiceNumber: invoice.invoiceNumber,\n          supplier: invoice.supplier,\n          amount: invoice.amount,\n          dueDate: invoice.dueDate,\n        },\n      });\n    }\n\n    return {\n      success: true,\n      count: overdueInvoices.length,\n    };\n  } catch (error) {\n    console.error(\"[v0] Error checking overdue invoices:\", error);\n    return { success: false, error: \"Failed to check overdue invoices\" };\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1784, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/models/Approval.ts"],"sourcesContent":["import mongoose, { Schema, model, models } from 'mongoose'\n\nconst ApprovalSchema = new Schema({\n  approvalId: { type: String, required: true, unique: true },\n  itemId: { type: String },\n  type: { \n    type: String, \n    enum: ['Requisition', 'Purchase Order'],\n    required: true\n  },\n  requester: { type: String, required: true },\n  dueDate: { type: Date },\n  status: { \n    type: String, \n    enum: [\n      'Awaiting your approval',\n      'Pending review',\n      'Parallel approval',\n      'SLA breached',\n      'approved',\n      'rejected',\n      'changes_requested'\n    ],\n    default: 'Awaiting your approval'\n  },\n  priority: { \n    type: String, \n    enum: ['High', 'Medium', 'Low', 'Critical']\n  },\n  amount: { type: Number, required: true },\n  costCenter: { type: String },\n  branch: { type: String },\n  approvedAt: { type: Date },\n  approvedBy: { type: String },\n  rejectedAt: { type: Date },\n  rejectedBy: { type: String },\n  requestedBy: { type: String },\n  decisionContext: {\n    totalAmount: Number,\n    budgetImpact: Number,\n    riskPolicy: String,\n    sla: String,\n    category: String,\n    neededBy: Date,\n    supplierPreference: String,\n    approvalRoute: String\n  },\n  reason: { type: String },\n  summary: {\n    items: [{\n      description: String,\n      qty: Number,\n      unit: String,\n      unitCost: Number,\n      total: Number\n    }]\n  },\n  timeline: [{\n    event: String,\n    timestamp: Date,\n    actor: String,\n    details: String\n  }],\n  comments: [{\n    author: String,\n    text: String,\n    date: Date\n  }]\n}, { timestamps: true })\n\nexport const Approval = models.Approval || model('Approval', ApprovalSchema)\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,iBAAiB,IAAI,mHAAM,CAAC;IAChC,YAAY;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACzD,QAAQ;QAAE,MAAM;IAAO;IACvB,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAe;SAAiB;QACvC,UAAU;IACZ;IACA,WAAW;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC1C,SAAS;QAAE,MAAM;IAAK;IACtB,QAAQ;QACN,MAAM;QACN,MAAM;YACJ;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QACD,SAAS;IACX;IACA,UAAU;QACR,MAAM;QACN,MAAM;YAAC;YAAQ;YAAU;YAAO;SAAW;IAC7C;IACA,QAAQ;QAAE,MAAM;QAAQ,UAAU;IAAK;IACvC,YAAY;QAAE,MAAM;IAAO;IAC3B,QAAQ;QAAE,MAAM;IAAO;IACvB,YAAY;QAAE,MAAM;IAAK;IACzB,YAAY;QAAE,MAAM;IAAO;IAC3B,YAAY;QAAE,MAAM;IAAK;IACzB,YAAY;QAAE,MAAM;IAAO;IAC3B,aAAa;QAAE,MAAM;IAAO;IAC5B,iBAAiB;QACf,aAAa;QACb,cAAc;QACd,YAAY;QACZ,KAAK;QACL,UAAU;QACV,UAAU;QACV,oBAAoB;QACpB,eAAe;IACjB;IACA,QAAQ;QAAE,MAAM;IAAO;IACvB,SAAS;QACP,OAAO;YAAC;gBACN,aAAa;gBACb,KAAK;gBACL,MAAM;gBACN,UAAU;gBACV,OAAO;YACT;SAAE;IACJ;IACA,UAAU;QAAC;YACT,OAAO;YACP,WAAW;YACX,OAAO;YACP,SAAS;QACX;KAAE;IACF,UAAU;QAAC;YACT,QAAQ;YACR,MAAM;YACN,MAAM;QACR;KAAE;AACJ,GAAG;IAAE,YAAY;AAAK;AAEf,MAAM,WAAW,mHAAM,CAAC,QAAQ,IAAI,IAAA,kHAAK,EAAC,YAAY"}},
    {"offset": {"line": 1908, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/actions/approval-actions.ts"],"sourcesContent":["'use server'\n\nimport { revalidatePath } from 'next/cache'\nimport { auth } from '@clerk/nextjs/server'\nimport dbConnect from '@/lib/mongodb'\nimport { createNotification } from '../actions/notification-actions'\nimport { Approval } from '../models/Approval'\n\nexport async function getApprovals() {\n  try {\n    await dbConnect()\n    const approvals = await Approval.find({})\n      .sort({ createdAt: -1 })\n      .limit(50)\n      .lean()\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(approvals))\n    }\n  } catch (error) {\n    console.error('[v0] Error fetching approvals:', error)\n    return { success: false, error: 'Failed to fetch approvals' }\n  }\n}\n\nexport async function getApprovalById(id: string) {\n  try {\n    await dbConnect()\n    const approval = await Approval.findById(id).lean()\n    \n    if (!approval) {\n      return { success: false, error: 'Approval not found' }\n    }\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(approval))\n    }\n  } catch (error) {\n    console.error('[v0] Error fetching approval:', error)\n    return { success: false, error: 'Failed to fetch approval' }\n  }\n}\n\nexport async function approveRequest(id: string, comments?: string) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return { success: false, error: 'Unauthorized' }\n    }\n    \n    await dbConnect()\n    \n    const updated = await Approval.findByIdAndUpdate(\n      id,\n      { \n        status: 'approved',\n        approvedAt: new Date(),\n        approvedBy: userId,\n      },\n      { new: true }\n    )\n    let approval = updated?.toObject()\n    if (comments && updated) {\n      approval = await Approval.findByIdAndUpdate(\n        id,\n        { $push: { comments: { author: userId, text: comments, date: new Date() } } },\n        { new: true }\n      ).lean()\n    } else {\n      approval = approval as any\n    }\n    \n    if (!approval) {\n      return { success: false, error: 'Approval not found' }\n    }\n    \n    const ap = approval as { _id: string; type?: string; itemId?: string; amount?: number }\n    const resourceType = ap.type ? ap.type.toLowerCase() : 'request'\n\n    await createNotification({\n      userId: 'REQUESTER_USER_ID',\n      type: 'approval_pending',\n      title: `${resourceType} Approved`,\n      message: `Your ${resourceType} ${ap.itemId ?? ''} for $${(ap.amount ?? 0).toLocaleString()} has been approved`,\n      actionUrl: `/${resourceType}s/${ap.itemId ?? ''}`,\n      priority: 'medium',\n      metadata: {\n        approvalId: ap._id,\n        itemId: ap.itemId ?? '',\n        amount: ap.amount ?? 0\n      }\n    })\n    \n    revalidatePath('/approvals')\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(approval))\n    }\n  } catch (error) {\n    console.error('[v0] Error approving request:', error)\n    return { success: false, error: 'Failed to approve request' }\n  }\n}\n\nexport async function rejectRequest(id: string, comments: string) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return { success: false, error: 'Unauthorized' }\n    }\n    \n    await dbConnect()\n    \n    const updated = await Approval.findByIdAndUpdate(\n      id,\n      { \n        status: 'rejected',\n        rejectedAt: new Date(),\n        rejectedBy: userId,\n      },\n      { new: true }\n    )\n    const approval = await Approval.findByIdAndUpdate(\n      id,\n      { $push: { comments: { author: userId, text: comments, date: new Date() } } },\n      { new: true }\n    ).lean()\n    \n    if (!approval) {\n      return { success: false, error: 'Approval not found' }\n    }\n    \n    {\n      const ap = approval as { _id: string; type?: string; itemId?: string; amount?: number }\n      const resourceType = ap.type ? ap.type.toLowerCase() : 'request'\n      await createNotification({\n        userId: 'REQUESTER_USER_ID',\n        type: 'approval_pending',\n        title: `${ap.type ?? 'Request'} Rejected`,\n        message: `Your ${resourceType} ${ap.itemId ?? ''} has been rejected. ${comments}`,\n        actionUrl: `/${resourceType}s/${ap.itemId ?? ''}`,\n        priority: 'high',\n        metadata: {\n          approvalId: ap._id,\n          itemId: ap.itemId ?? '',\n          amount: ap.amount ?? 0,\n          rejectionReason: comments\n        }\n      })\n    }\n    \n    revalidatePath('/approvals')\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(approval))\n    }\n  } catch (error) {\n    console.error('[v0] Error rejecting request:', error)\n    return { success: false, error: 'Failed to reject request' }\n  }\n}\n\nexport async function requestChanges(id: string, comments: string) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return { success: false, error: 'Unauthorized' }\n    }\n    \n    await dbConnect()\n    \n    const updated = await Approval.findByIdAndUpdate(\n      id,\n      { \n        status: 'changes_requested',\n        requestedBy: userId,\n      },\n      { new: true }\n    )\n    const approval = await Approval.findByIdAndUpdate(\n      id,\n      { $push: { comments: { author: userId, text: comments, date: new Date() } } },\n      { new: true }\n    ).lean()\n    \n    if (!approval) {\n      return { success: false, error: 'Approval not found' }\n    }\n    \n    {\n      const ap = approval as { _id: string; type?: string; itemId?: string }\n      const resourceType = ap.type ? ap.type.toLowerCase() : 'request'\n      await createNotification({\n        userId: 'REQUESTER_USER_ID',\n        type: 'approval_pending',\n        title: 'Changes Requested',\n        message: `Changes requested for ${resourceType} ${ap.itemId ?? ''}. ${comments}`,\n        actionUrl: `/${resourceType}s/${ap.itemId ?? ''}`,\n        priority: 'medium',\n        metadata: {\n          approvalId: ap._id,\n          itemId: ap.itemId ?? '',\n          changeComments: comments\n        }\n      })\n    }\n    \n    revalidatePath('/approvals')\n    \n    return { \n      success: true, \n      data: JSON.parse(JSON.stringify(approval))\n    }\n  } catch (error) {\n    console.error('[v0] Error requesting changes:', error)\n    return { success: false, error: 'Failed to request changes' }\n  }\n}\n\nexport async function bulkApprove(ids: string[], comments?: string) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return { success: false, error: 'Unauthorized' }\n    }\n\n    await dbConnect()\n\n    const now = new Date()\n    await Approval.updateMany(\n      { _id: { $in: ids } },\n      { $set: { status: 'approved', approvedAt: now, approvedBy: userId } }\n    )\n\n    if (comments) {\n      await Approval.updateMany(\n        { _id: { $in: ids } },\n        { $push: { comments: { author: userId, text: comments, date: now } } }\n      )\n    }\n\n    revalidatePath('/approvals')\n\n    return { success: true, count: ids.length }\n  } catch (error) {\n    console.error('[v0] Error bulk approving:', error)\n    return { success: false, error: 'Failed to bulk approve' }\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2245, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/models/Company.ts"],"sourcesContent":["import mongoose, { Schema, model, models } from 'mongoose'\n\nconst CompanySchema = new Schema({\n  companyId: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  approved: { type: Boolean, default: false },\n  industry: { type: String },\n  region: { type: String },\n  size: { type: String },\n  contactEmail: { type: String },\n  ownerUserId: { type: String, required: true, index: true },\n  onboarding: {\n    companyInformation: {\n      organizationType: String,\n      address: String,\n      officialEmail: String,\n      phone: String,\n      website: String,\n    },\n    contactPerson: {\n      name: String,\n      role: String,\n      phone: String,\n      email: String,\n    },\n    businessOperations: {\n      description: String,\n      hasBranches: Boolean,\n      numberOfBranches: Number,\n      branchLocations: String,\n      centralStore: String,\n    },\n    procurementStructure: {\n      currentMethod: String,\n      requiresApprovalWorkflows: Boolean,\n      approvalLevels: [String],\n      manager: {\n        name: String,\n        position: String,\n        email: String,\n      }\n    },\n    userSetup: {\n      employeeAccessCount: String,\n      departments: [String],\n      otherDepartment: String,\n    },\n    documents: {\n      registrationUploads: [{ name: String, size: Number, type: String }],\n      tin: String,\n      logoUploads: [{ name: String, size: Number, type: String }],\n    },\n    systemConfiguration: {\n      vendorsSelfOnboard: String,\n      tenderingEnabled: Boolean,\n      eInvoicingEnabled: Boolean,\n      analyticsEnabled: Boolean,\n    },\n    responsibilities: {\n      systemManagerName: String,\n      systemManagerRole: String,\n      invoicesApprover: String,\n      poApprover: String,\n      goodsReceiver: String,\n    },\n    teamMembers: {\n      projectLead: String,\n      trainingOfficer: String,\n    },\n    declarations: {\n      infoAccurate: Boolean,\n      agreeOnboarding: Boolean,\n    }\n  },\n}, { timestamps: true })\n\nexport const Company = models.Company || model('Company', CompanySchema)\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,gBAAgB,IAAI,mHAAM,CAAC;IAC/B,WAAW;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACxD,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,UAAU;QAAE,MAAM;QAAS,SAAS;IAAM;IAC1C,UAAU;QAAE,MAAM;IAAO;IACzB,QAAQ;QAAE,MAAM;IAAO;IACvB,MAAM;QAAE,MAAM;IAAO;IACrB,cAAc;QAAE,MAAM;IAAO;IAC7B,aAAa;QAAE,MAAM;QAAQ,UAAU;QAAM,OAAO;IAAK;IACzD,YAAY;QACV,oBAAoB;YAClB,kBAAkB;YAClB,SAAS;YACT,eAAe;YACf,OAAO;YACP,SAAS;QACX;QACA,eAAe;YACb,MAAM;YACN,MAAM;YACN,OAAO;YACP,OAAO;QACT;QACA,oBAAoB;YAClB,aAAa;YACb,aAAa;YACb,kBAAkB;YAClB,iBAAiB;YACjB,cAAc;QAChB;QACA,sBAAsB;YACpB,eAAe;YACf,2BAA2B;YAC3B,gBAAgB;gBAAC;aAAO;YACxB,SAAS;gBACP,MAAM;gBACN,UAAU;gBACV,OAAO;YACT;QACF;QACA,WAAW;YACT,qBAAqB;YACrB,aAAa;gBAAC;aAAO;YACrB,iBAAiB;QACnB;QACA,WAAW;YACT,qBAAqB;gBAAC;oBAAE,MAAM;oBAAQ,MAAM;oBAAQ,MAAM;gBAAO;aAAE;YACnE,KAAK;YACL,aAAa;gBAAC;oBAAE,MAAM;oBAAQ,MAAM;oBAAQ,MAAM;gBAAO;aAAE;QAC7D;QACA,qBAAqB;YACnB,oBAAoB;YACpB,kBAAkB;YAClB,mBAAmB;YACnB,kBAAkB;QACpB;QACA,kBAAkB;YAChB,mBAAmB;YACnB,mBAAmB;YACnB,kBAAkB;YAClB,YAAY;YACZ,eAAe;QACjB;QACA,aAAa;YACX,aAAa;YACb,iBAAiB;QACnB;QACA,cAAc;YACZ,cAAc;YACd,iBAAiB;QACnB;IACF;AACF,GAAG;IAAE,YAAY;AAAK;AAEf,MAAM,UAAU,mHAAM,CAAC,OAAO,IAAI,IAAA,kHAAK,EAAC,WAAW"}},
    {"offset": {"line": 2369, "column": 0}, "map": {"version":3,"sources":["file:///C:/my-projects/InnoslProcura/lib/actions/onboarding-actions.ts"],"sourcesContent":["'use server'\n\nimport { revalidatePath } from 'next/cache'\nimport { auth, clerkClient } from '@clerk/nextjs/server'\nimport dbConnect from '@/lib/mongodb'\nimport { Supplier } from '../models/Supplier'\nimport { Company } from '../models/Company'\n\nexport async function submitAdminOnboarding(data: {\n  fullName: string\n  title?: string\n  company?: string\n  profileDetails?: string\n}) {\n  try {\n    const { userId } = await auth()\n    if (!userId) return { success: false, error: 'Unauthorized' }\n\n    const client = await clerkClient()\n\n    let firstName = ''\n    let lastName = ''\n    const parts = String(data.fullName || '').trim().split(/\\s+/)\n    if (parts.length > 0) firstName = parts[0]\n    if (parts.length > 1) lastName = parts.slice(1).join(' ')\n\n    await client.users.updateUser(userId, {\n      firstName: firstName || undefined,\n      lastName: lastName || undefined,\n      publicMetadata: {\n        role: 'admin',\n        onboarded: true,\n        onboardingStatus: 'pending_superadmin_approval',\n        adminProfile: {\n          fullName: data.fullName,\n          title: data.title || '',\n          company: data.company || '',\n          profileDetails: data.profileDetails || '',\n        },\n      },\n    })\n\n    revalidatePath('/onboarding')\n    return { success: true }\n  } catch (error) {\n    return { success: false, error: 'Failed to submit admin onboarding' }\n  }\n}\n\nexport async function submitCompanyOnboarding(data: {\n  companyName: string\n  industry?: string\n  region?: string\n  size?: string\n  contactEmail?: string\n  organizationType?: string\n  address?: string\n  officialEmail?: string\n  companyPhone?: string\n  website?: string\n  contactPersonName?: string\n  contactPersonRole?: string\n  contactPersonPhone?: string\n  contactPersonEmail?: string\n  businessDescription?: string\n  hasBranches?: boolean\n  numberOfBranches?: number\n  branchLocations?: string\n  centralStore?: string\n  procurementMethod?: string\n  requiresApprovalWorkflows?: boolean\n  approvalLevels?: string[]\n  managerName?: string\n  managerPosition?: string\n  managerEmail?: string\n  employeeAccessCount?: string\n  departments?: string[]\n  otherDepartment?: string\n  registrationUploads?: { name: string; size: number; type: string }[]\n  tin?: string\n  logoUploads?: { name: string; size: number; type: string }[]\n  vendorsSelfOnboard?: string\n  tenderingEnabled?: boolean\n  eInvoicingEnabled?: boolean\n  analyticsEnabled?: boolean\n  systemManagerName?: string\n  systemManagerRole?: string\n  invoicesApprover?: string\n  poApprover?: string\n  goodsReceiver?: string\n  projectLead?: string\n  trainingOfficer?: string\n  declarationInfoAccurate?: boolean\n  declarationAgreeOnboarding?: boolean\n}) {\n  try {\n    const { userId } = await auth()\n    if (!userId) {\n      return { success: false, error: 'Unauthorized' }\n    }\n\n    await dbConnect()\n    const count = await Company.countDocuments()\n    const companyId = `COMP-${(count + 1000).toString()}`\n\n    await Company.create({\n      companyId,\n      name: data.companyName,\n      approved: false,\n      industry: data.industry || '',\n      region: data.region || '',\n      size: data.size || '',\n      contactEmail: data.contactEmail || '',\n      ownerUserId: userId,\n      onboarding: {\n        companyInformation: {\n          organizationType: data.organizationType || '',\n          address: data.address || '',\n          officialEmail: data.officialEmail || '',\n          phone: data.companyPhone || '',\n          website: data.website || '',\n        },\n        contactPerson: {\n          name: data.contactPersonName || '',\n          role: data.contactPersonRole || '',\n          phone: data.contactPersonPhone || '',\n          email: data.contactPersonEmail || '',\n        },\n        businessOperations: {\n          description: data.businessDescription || '',\n          hasBranches: Boolean(data.hasBranches),\n          numberOfBranches: typeof data.numberOfBranches === 'number' ? data.numberOfBranches : 0,\n          branchLocations: data.branchLocations || '',\n          centralStore: data.centralStore || '',\n        },\n        procurementStructure: {\n          currentMethod: data.procurementMethod || '',\n          requiresApprovalWorkflows: Boolean(data.requiresApprovalWorkflows),\n          approvalLevels: Array.isArray(data.approvalLevels) ? data.approvalLevels : [],\n          manager: {\n            name: data.managerName || '',\n            position: data.managerPosition || '',\n            email: data.managerEmail || '',\n          },\n        },\n        userSetup: {\n          employeeAccessCount: data.employeeAccessCount || '',\n          departments: Array.isArray(data.departments) ? data.departments : [],\n          otherDepartment: data.otherDepartment || '',\n        },\n        documents: {\n          registrationUploads: Array.isArray(data.registrationUploads) ? data.registrationUploads : [],\n          tin: data.tin || '',\n          logoUploads: Array.isArray(data.logoUploads) ? data.logoUploads : [],\n        },\n        systemConfiguration: {\n          vendorsSelfOnboard: data.vendorsSelfOnboard || '',\n          tenderingEnabled: Boolean(data.tenderingEnabled),\n          eInvoicingEnabled: Boolean(data.eInvoicingEnabled),\n          analyticsEnabled: Boolean(data.analyticsEnabled),\n        },\n        responsibilities: {\n          systemManagerName: data.systemManagerName || '',\n          systemManagerRole: data.systemManagerRole || '',\n          invoicesApprover: data.invoicesApprover || '',\n          poApprover: data.poApprover || '',\n          goodsReceiver: data.goodsReceiver || '',\n        },\n        teamMembers: {\n          projectLead: data.projectLead || '',\n          trainingOfficer: data.trainingOfficer || '',\n        },\n        declarations: {\n          infoAccurate: Boolean(data.declarationInfoAccurate),\n          agreeOnboarding: Boolean(data.declarationAgreeOnboarding),\n        },\n      },\n    })\n\n    const client = await clerkClient()\n    await client.users.updateUser(userId, {\n      publicMetadata: {\n        role: 'company',\n        companyId,\n        onboardingStatus: 'pending_admin_approval',\n        company: {\n          name: data.companyName,\n          industry: data.industry || '',\n          region: data.region || '',\n          size: data.size || '',\n          contactEmail: data.contactEmail || '',\n        },\n        onboarded: false,\n      },\n    })\n\n    revalidatePath('/onboarding')\n    return { success: true, data: { companyId } }\n  } catch (error) {\n    return { success: false, error: 'Failed to submit company onboarding' }\n  }\n}\n\nexport async function submitSupplierOnboarding(data: {\n  name: string\n  contactPerson?: string\n  phone?: string\n  email?: string\n  goodsType?: string\n  productCategories?: string[]\n  supplyAreas?: string[]\n  deliveryTimeline?: string\n  priceListUploads?: { name: string; size: number; type: string }[]\n  registrationCertificateUploads?: { name: string; size: number; type: string }[]\n  businessRegistrationCertificateUploads?: { name: string; size: number; type: string }[]\n  taxClearanceCertificateUploads?: { name: string; size: number; type: string }[]\n  gstVatRegistrationCertificateUploads?: { name: string; size: number; type: string }[]\n  businessLicenseUploads?: { name: string; size: number; type: string }[]\n  nassitCertificateUploads?: { name: string; size: number; type: string }[]\n  sectorSpecificCertificateUploads?: { name: string; size: number; type: string }[]\n  paymentMethods?: string[]\n  bankDetails?: { bankName?: string; accountName?: string; accountNumber?: string; prefersCash?: boolean }\n  declarations?: { infoAccurate?: boolean; agreeRules?: boolean }\n  category?: string\n  region?: string\n  segment?: string\n}) {\n  try {\n    const { userId } = await auth()\n    if (!userId) return { success: false, error: 'Unauthorized' }\n    await dbConnect()\n    const count = await Supplier.countDocuments()\n    const supplierId = `SUP-${(count + 5000).toString()}`\n    const supplier = await Supplier.create({\n      supplierId,\n      name: data.name,\n      approved: false,\n      ownerUserId: userId,\n      category: data.category || 'General',\n      region: data.region || 'Global',\n      segment: data.segment || 'Standard',\n      onboarding: {\n        contactPerson: data.contactPerson || '',\n        phone: data.phone || '',\n        email: data.email || '',\n        goodsType: data.goodsType || '',\n        productCategories: Array.isArray(data.productCategories) ? data.productCategories : [],\n        supplyAreas: Array.isArray(data.supplyAreas) ? data.supplyAreas : [],\n        deliveryTimeline: data.deliveryTimeline || '',\n        priceListUploads: Array.isArray(data.priceListUploads) ? data.priceListUploads : [],\n        registrationCertificateUploads: Array.isArray(data.registrationCertificateUploads) ? data.registrationCertificateUploads : [],\n        businessRegistrationCertificateUploads: Array.isArray(data.businessRegistrationCertificateUploads) ? data.businessRegistrationCertificateUploads : [],\n        taxClearanceCertificateUploads: Array.isArray(data.taxClearanceCertificateUploads) ? data.taxClearanceCertificateUploads : [],\n        gstVatRegistrationCertificateUploads: Array.isArray(data.gstVatRegistrationCertificateUploads) ? data.gstVatRegistrationCertificateUploads : [],\n        businessLicenseUploads: Array.isArray(data.businessLicenseUploads) ? data.businessLicenseUploads : [],\n        nassitCertificateUploads: Array.isArray(data.nassitCertificateUploads) ? data.nassitCertificateUploads : [],\n        sectorSpecificCertificateUploads: Array.isArray(data.sectorSpecificCertificateUploads) ? data.sectorSpecificCertificateUploads : [],\n        paymentMethods: Array.isArray(data.paymentMethods) ? data.paymentMethods : [],\n        bankDetails: {\n          bankName: data.bankDetails?.bankName || '',\n          accountName: data.bankDetails?.accountName || '',\n          accountNumber: data.bankDetails?.accountNumber || '',\n          prefersCash: Boolean(data.bankDetails?.prefersCash),\n        },\n        declarations: {\n          infoAccurate: Boolean(data.declarations?.infoAccurate),\n          agreeRules: Boolean(data.declarations?.agreeRules),\n        },\n      },\n      performanceScore: 0,\n      riskRating: 'Low',\n      totalSpend: 0,\n    })\n\n    const client2 = await clerkClient()\n    await client2.users.updateUser(userId, {\n      publicMetadata: {\n        role: 'supplier',\n        supplierId,\n        onboardingStatus: 'pending_admin_approval',\n        onboarded: false,\n      },\n    })\n\n    revalidatePath('/onboarding')\n    return { success: true, data: JSON.parse(JSON.stringify(supplier)) }\n  } catch (error) {\n    return { success: false, error: 'Failed to submit supplier onboarding' }\n  }\n}\n"],"names":[],"mappings":"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"}}]
}